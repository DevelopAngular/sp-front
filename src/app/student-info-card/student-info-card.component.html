<div class="wrapper" *ngIf="!!profile">
  <div class="student-card-container">
    <div class="left" #left (scroll)="scroll($event)">
      <div class="left-header" [style.box-shadow]="isScrollable ? '0 2px 4px 0 rgba(0, 0, 0, 0.1)' : 'none'">
        <div class="back">
          <app-round-button [icon]="'Chevron Left'"></app-round-button>
        </div>
        <div class="avatar-content">
          <div class="avatar"
               [@openCloseProfile]="animationTrigger"
               #avatarContainer
               (mouseenter)="avatarContainer.hover = true"
               (mouseleave)="avatarContainer.hover = false"
          >
            <div class="loading-theme_blue-gray spinner" *ngIf="loadingProfilePicture | async">
              <mat-spinner style="color: #7f879d" [diameter]="30"></mat-spinner>
            </div>
            <div *ngIf="profile && profile.profile_picture; else d" [ngStyle]="{'background': 'url(' + profile.profile_picture + ') no-repeat left center/cover', width: '88px', height: '88px'}"></div>
            <ng-template #d>
              <img [@openCloseProfile]="animationTrigger" width="88" height="88" [src]="'./assets/Avatar Default.svg' | resolveAsset" alt="Avatar">
            </ng-template>
            <div *ngIf="avatarContainer.hover && !isScrollable" class="hover-backdrop"></div>
            <div class="buttons" *ngIf="!(loadingProfilePicture | async) && !isScrollable">
              <img (click)="openEditAvatar($event)" *ngIf="avatarContainer.hover" class="add-avatar" [style.top]="!profile.profile_picture ? '30px' : '15px'" [src]="'./assets/' + (profile.profile_picture ? 'Edit' : 'Add') + ' Avatar (White).svg' | resolveAsset" alt="add">
              <img (click)="deleteAvatar()" *ngIf="avatarContainer.hover && profile.profile_picture" [src]="'./assets/Delete (White).svg'" [style.bottom]="'15px'" class="add-avatar" alt="Delete">
            </div>

          </div>
          <div class="student-name" [style.font-size]="isScrollable ? '13px' : '28px'">{{ profile?.display_name }}</div>
        </div>

        <div class="top-buttons">
          <!--      <app-round-button [icon]="'Notifications'" (buttonClick)="openNotification()"></app-round-button>-->
          <app-round-button style="margin-left: 13px" [icon]="'Dots'" (buttonClick)="openStudentSettings($event)"></app-round-button>
        </div>
      </div>

      <div class="content">
        <div class="student-passes-info" *ngIf="!(loadingPassesStats$ | async); else fakeStats">
          <div class="card-info"
               [customToolTip]="'The student had ' + (passesStats$ | async)?.past_passes_today + ((passesStats$ | async)?.past_passes_today === 1 ? ' pass' : ' passes') +  ' today.'"
               [nonDisappearing]="false"
               [editable]="true"
          >
            <div class="title">{{ (passesStats$ | async)?.past_passes_today }}</div>
            <div class="subtitle">today</div>
          </div>
          <div class="card-info"
               [customToolTip]="'The student had ' + (passesStats$ | async)?.past_passes_week + ((passesStats$ | async)?.past_passes_week === 1 ? ' pass' : ' passes') +  ' this week.'"
               [nonDisappearing]="false"
               [editable]="true"
          >
            <div class="title">{{ (passesStats$ | async)?.past_passes_week }}</div>
            <div class="subtitle">this week</div>
          </div>
          <div class="card-info"
               [customToolTip]="'The student had ' + (passesStats$ | async)?.past_passes_month + ((passesStats$ | async)?.past_passes_month === 1 ? ' pass' : ' passes') +  ' this month.'"
               [nonDisappearing]="false"
               [editable]="true"
          >
            <div class="title">{{ (passesStats$ | async)?.past_passes_month }}</div>
            <div class="subtitle">this month</div>
          </div>
        </div>

        <ng-template #fakeStats>
          <div class="student-passes-info">
            <div class="fake-card-stats fake-animate" *ngFor="let card of [1, 1, 1]"></div>
          </div>
        </ng-template>

        <div class="forms">
          <div class="form" style="flex-direction: column" *ngIf="!(exclusionGroupsLoading$ | async); else fakeForm">
            <div class="card">
              <div class="label">
                <div class="icon" style="background-color: #E32C66">
                  <app-octagon [size]="20" [backgroundColor]="'#E32C66'">
                    <img style="position: absolute; z-index: 10;" height="14px" [src]="'./assets/Walking One (White).svg' | resolveAsset" alt="">
                  </app-octagon>
                </div>
                <div class="title" style="font-weight: 600">Encounter Prevention</div>
              </div>
              <div class="add-button">
                <app-gradient-button
                  [size]="'editable'"
                  [minWidth]="'50px'"
                  [minHeight]="'31px'"
                  [textColor]="'#7F879D'"
                  [gradient]="'#FFFFFF, #FFFFFF'"
                  [hoverColor]="'#FFFFFF'"
                  [leftIcon]="'./assets/Plus (Blue-Gray).svg'"
                  [leftImageWidth]="'16px'"
                  [leftImageHeight]="'16px'"
                  [withShadow]="false"
                  [fontSize]="'14px'"
                  (buttonClick)="openEncounterPrevention('newGroup')"
                >Add</app-gradient-button>
              </div>
            </div>

            <div class="groups" *ngIf="(exclusionGroups$ | async) && (exclusionGroups$ | async).length">
              <div class="group"
                   *ngFor="let group of exclusionGroups$ | async"
                   [showToolTip]="!!group.notes"
                   [customToolTip]="group.notes"
                   [editable]="true"
                   [positionStrategy]="{originX: 'center',originY: 'top',overlayX: 'center',overlayY: 'top',offsetX: 210}"
              >
                <app-encounter-group [group]="group" [backgroundColor]="'#FFFFFF'" (clickEvent)="openEncounterPrevention('groupDescription', group)"></app-encounter-group>
              </div>
            </div>
          </div>
          <ng-template #fakeForm>
            <div class="form fake-animate"></div>
          </ng-template>
          <!--        <div class="form">-->
          <!--          <div class="icon" style="background-color: #E48C15">-->
          <!--            <img width="13px" [src]="'./assets/Lock (White).svg' | resolveAsset" alt="">-->
          <!--          </div>-->
          <!--          <div class="title">Restrict all rooms</div>-->
          <!--        </div>-->
          <!--        <div class="form">-->
          <!--          <div class="icon" style="background-color: #6651F1">-->
          <!--            <img width="16px" [src]="'./assets/Pass Quota (White).svg' | resolveAsset" alt="">-->
          <!--          </div>-->
          <!--          <div class="title">Pass quota</div>-->
          <!--        </div>-->

          <div class="form">
            <div class="form-content-container">
              <div class="form-content">
                <div class="title">Status</div>
                <div class="status-value" style="cursor: pointer" (click)="openStatusPopup($event)" [style.color]="profile && profile?.status === 'active' ? '#00B476' : (profile && profile?.status === 'disabled' ? '#7f879d' : '#6651F1')">{{ profile?.status }}
                  <span><img width="9px" [src]="'./assets/Chevron Down (' + (profile && profile?.status === 'active' ? 'Jade' : (profile && profile?.status === 'disabled' ? 'Blue-Gray' : 'Soft-Blue')) + ').svg' | resolveAsset" alt=""></span>
                </div>
              </div>
              <div class="form-content">
                <div class="title">Last Active</div>
                <div class="value">{{ profile?.last_login ? getLastActiveDate(profile?.last_login) : '-' }}</div>
              </div>
            </div>
          </div>

          <div class="form" style="flex-direction: column; align-items: flex-start">
            <div class="form-content">
              <div class="title">Email</div>
              <div class="value">{{ profile?.primary_email.toLowerCase() }}</div>
            </div>
            <div class="form-content" [style.margin]="'20px 0'">
              <app-select-role
                [selectedRoles]="[{id: 1, role: 'Student', icon: './assets/Student (Navy).svg'}]"
                [isAccessAdd]="false"
                [cardsBackground]="'#FFFFFF'"
              ></app-select-role>
            </div>

            <div class="form-content">
              <div class="title">School</div>
              <div class="value">{{ school?.name }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="scrolling-container" #right (scroll)="rightScroll($event)">
      <div class="header-container">
        <div class="header">
          <div class="buttons">
            <div class="date-button" #dateButton>
              <app-gradient-button
                [gradient]="'#FFFFFF, #FFFFFF'"
                [leftIcon]="'./assets/Calendar (Navy).svg'"
                [leftImageWidth]="'18px'"
                [leftImageHeight]="'18px'"
                [rightIcon]="'./assets/Rect (Navy).svg'"
                [rightIconWidth]="'8px'"
                [rightIconHeight]="'8px'"
                [size]="'medium'"
                [textColor]="'#1F195E'"
                (buttonClick)="openDateFilter($event)"
              >{{ dateText(selectedDate) }}</app-gradient-button>
            </div>

            <app-square-button
              [backgroundColor]="'#edcbd9'"
              (buttonClick)="openReportForm()"
              [customToolTip]="'Report student'"
              [nonDisappearing]="false"
              [editable]="true"
            >
              <img width="20" [src]="'./assets/Report (Red).svg' | resolveAsset">
            </app-square-button>

            <app-gradient-button
              [leftIcon]="'./assets/Plus (White).svg'"
              (buttonClick)="openCreatePassPopup($event)"
              [gradient]="'#00B467, #15D593'"
              [isGradient]="true"
              [size]="'medium'"
            >Create Pass</app-gradient-button>
          </div>
        </div>

        <div class="divider" style="padding: 0 40px">
          <mat-divider style="border-color: #E2E6EC" *ngIf="isRightScroll"></mat-divider>
        </div>

      </div>

      <div class="right">
        <div class="content">
          <div class="block">
            <app-overview-container
              [title]="'Overview'"
              [icon]="'./assets/Overview (Navy).svg'"
              (clickFilter)="openFilter($event)"
            >
              <div class="info-cards" *ngIf="!(studentsStatsLoading$ | async); else fakeInfo">
                <div class="info-card">
                  <div class="title">PASSES CREATED</div>
                  <div class="value">{{ (studentStats$ | async)?.expired_passes.length + ' passes' }}</div>
                </div>
                <div class="info-card">
                  <div class="title">TIME SPENT OUT OF CLASS</div>
                  <div class="value">{{ '1hr 13 min' }}</div>
                </div>
                <div class="info-card">
                  <div class="title">PASSES OVER TIME LIMIT</div>
                  <div class="value">{{ (studentStats$ | async)?.over_time_limit + ' passes' }}</div>
                </div>
                <div class="info-card">
                  <div class="title">PASSES AUTO-ENDED</div>
                  <div class="value">{{ (studentStats$ | async)?.auto_ended + ' pass' }}</div>
                </div>
              </div>

              <ng-template #fakeInfo>
                <div class="info-cards">
                  <div class="fake-card fake-animate" *ngFor="let pass of [1, 1, 1, 1]"></div>
                </div>
              </ng-template>
            </app-overview-container>
          </div>
          <div class="block">
            <app-overview-container
              [title]="'Passes'"
              [icon]="'./assets/Passes (Navy).svg'"
              (clickFilter)="openFilter($event)"
            >
              <div class="block-container">
                <div class="info-cards" *ngIf="!(studentsStatsLoading$ | async); else fakePasses">
                  <ng-container *ngIf="(studentStats$ | async) && (studentStats$ | async).expired_passes.length; else emptyPassState">
                    <ng-container *ngFor="let pass of (studentStats$ | async)?.expired_passes; let i = index">
                      <app-pass-tile
                        *ngIf="i <= 5"
                        [forFuture]="false"
                        [fromPast]="true"
                        [forStaff]="false"
                        [pass]="pass"
                        [profileImage]="false"
                        [isMiniCard]="true"
                        (tileSelected)="openPassCard($event)"
                      ></app-pass-tile>
                      <app-pass-tile
                        *ngIf="(i > 5 && isFullScreenPasses)"
                        [forFuture]="false"
                        [fromPast]="true"
                        [forStaff]="false"
                        [pass]="pass"
                        [profileImage]="false"
                        [isMiniCard]="true"
                        (tileSelected)="openPassCard($event)"
                      ></app-pass-tile>
                    </ng-container>
                  </ng-container>
                  <ng-template #emptyPassState>
                    <div class="empty-state">
                      <div class="icon">
                        <img width="59px" [src]="'./assets/Passes (Blue-Gray).svg' | resolveAsset">
                      </div>
                      <div class="title">No passes have been created yet</div>
                    </div>
                  </ng-template>
                </div>

                <ng-template #fakePasses>
                  <div class="info-cards">
                    <div class="fake-pass fake-animate" *ngFor="let pass of [1, 1, 1, 1, 1, 1]"></div>
                  </div>
                </ng-template>

                <app-gradient-button
                  [style.margin-top]="'20px'"
                  *ngIf="(studentStats$ | async) && (studentStats$ | async)?.expired_passes.length > 6 && !(studentsStatsLoading$ | async)"
                  [gradient]="'#FFFFFF, #FFFFFF'"
                  [leftIcon]="isFullScreenPasses ? './assets/Chevron Up (Blue-Gray).svg' : './assets/Chevron Down (Blue-Gray).svg'"
                  [textColor]="'#7f879d'"
                  (buttonClick)="isFullScreenPasses = !isFullScreenPasses"
                >{{ isFullScreenPasses ? 'Collapse' : 'See all ' + (studentStats$ | async)?.expired_passes.length + ' passes' }}
                </app-gradient-button>
              </div>
            </app-overview-container>
          </div>
          <div class="block">
            <app-overview-container
              [title]="'Reports'"
              [icon]="'./assets/Report (Navy).svg'"
              (clickFilter)="openFilter($event)"
            >
              <div class="block-container">
                <div class="info-cards" *ngIf="!(studentsStatsLoading$ | async); else fakeReports">
                  <ng-container *ngIf="(studentStats$ | async) && (studentStats$ | async).reports.length; else emptyReportState">
                    <ng-container *ngFor="let report of (studentStats$ | async)?.reports; let i = index">
                      <div class="report" *ngIf="i <= 3">
                        <div class="date">{{ getDate(report.created) }}</div>
                        <div class="description">{{ report.message }}</div>
                      </div>
                      <div class="report" *ngIf="i > 3 && isFullScreenReports">
                        <div class="date">{{ getDate(report.created) }}</div>
                        <div class="description">{{ report.message }}</div>
                      </div>
                    </ng-container>
                  </ng-container>

                  <ng-template #emptyReportState>
                    <div class="empty-state">
                      <div class="icon"><img width="78px" [src]="'./assets/Report (Blue-Gray).svg' | resolveAsset"></div>
                      <div class="title">Once a teacher reports a student, itâ€™ll show up here</div>
                    </div>
                  </ng-template>
                </div>

                <ng-template #fakeReports>
                  <div class="info-cards">
                    <div class="fake-report fake-animate" *ngFor="let report of [1, 1, 1, 1]"></div>
                  </div>
                </ng-template>

                <app-gradient-button
                  [style.margin-top]="'20px'"
                  *ngIf="(studentStats$ | async) && (studentStats$ | async)?.reports.length > 6 && !(studentsStatsLoading$ | async)"
                  [gradient]="'#FFFFFF, #FFFFFF'"
                  [leftIcon]="isFullScreenReports ? './assets/Chevron Up (Blue-Gray).svg' : './assets/Chevron Down (Blue-Gray).svg'"
                  [textColor]="'#7f879d'"
                  (buttonClick)="isFullScreenReports = !isFullScreenReports"
                >{{ isFullScreenReports ? 'Collapse' : 'See all ' + (studentStats$ | async)?.reports.length + ' reports' }}
                </app-gradient-button>
              </div>
            </app-overview-container>
          </div>
        </div>
        <!--    <div class="feedback-button">-->
        <!--      <app-feedback-button></app-feedback-button>-->
        <!--    </div>-->
      </div>
    </div>
  </div>
</div>
