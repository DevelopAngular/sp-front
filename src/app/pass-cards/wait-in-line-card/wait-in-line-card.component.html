<div class="pass-card-container">
  <div class="pass-card-wrapper" [@scalePassCards]="scaleCardTrigger$ | async" #cardWrapper [style.background-image]="gradient" [style.height]="forStaff || data?.kioskMode ? (isModal ? '400px' : '451px') : '412px'" ondragstart="return false">

    <div class="pass-card-header">
      <div class="header-content">
        <div class="header-info">
          <img  class="pass-card-header-icon" [src]="wil.icon | resolveAsset" alt="Wait in Line Destination Room Icon">
          <div class="pass-card-header-text">
            <span>{{ wil.destination.title }}</span>
          </div>
        </div>
        <div *ngIf="passForStudentsComponent" appCrossPointerEventTarget (pointerClickEvent)="dialogRef.close()" style="position: absolute; right: 10px; top: 10px; cursor: pointer">
          <img width="25" height="25" [src]="'./assets/Cancel (Transparent).svg' | resolveAsset" alt="">
        </div>

        <app-icon-button srcString="./assets/Chevron Left (Transparent).svg" [onDarkShade]="true" [size]="20" (clickEvent)="cancelEdit()"></app-icon-button>

      </div>
      <mat-divider></mat-divider>
    </div>
    <div class="pass-card-content" *ngIf="!isModal">
      <div class="duration-picker">
        <app-traveltype-picker
          [width]="(wil.destination.travel_types.length < 2 ? '106px' : '185px')"
          [height]="'32px'"
          (onSelect)="selectedTravelType=$event" [choices]="wil.destination.travel_types" [altColor]="wil.color_profile.solid_color"></app-traveltype-picker>
        <app-duration-picker [forStaff]="forStaff" (onChange)="selectedDuration=$event" [maxDuration]="wil.destination.max_allowed_time?wil.destination.max_allowed_time:15"></app-duration-picker>
      </div>
      <div class="button">
        <app-card-button (onClick)="queuePassInLine()" [disabled]="performingAction" [width]="buttonWidth +'px'" [height]="'79px'" [gradientColor]="wil.color_profile.gradient_color">
          <div *ngIf="!performingAction; else spinner" class="start-pass-content ds-mr-20">
            <div class="start-pass-content-text" style="display: flex">
              <img [src]="'./assets/Clock (White).svg' | resolveAsset" alt="Clock face">
              <span class="ds-mx-20">{{forStaff ? 'Send to Line' : 'Wait In Line'}}</span>
            </div>
            <img class="button-icon-right" [src]="'./assets/SP Arrow (White).svg' | resolveAsset" alt="Start pass button">
          </div>

          <ng-template #spinner>
            <div class="start-pass-content">
              <mat-spinner [color]="'accent'" [diameter]="35"></mat-spinner>
            </div>
          </ng-template>
        </app-card-button>

      </div>
    </div>

    <div class="pass-card-content-modal" *ngIf="isModal">
      <div class="center-block">

<!--        <app-travel-view *ngIf="wil.cancellable_by_student || data.kioskMode; else message" [pass]="pass"></app-travel-view>-->

        <ng-template #message>
          <ng-container *ngIf="!isMobile; else mobile">
            <app-pager [arrowPosition]="'-93px'" [isStaff]="true" >
              <div class="page-1" [attr.data-motion-translate]="(frameMotion$ | async).direction">
<!--                <app-travel-view-->
<!--                  [forStaff]="forStaff"-->
<!--                  [height]="'170px'"-->
<!--                  [pass]="pass"-->
<!--                ></app-travel-view>-->
              </div>
              <div class="page-2" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <div style="display: flex; justify-content: center">
                  <div class="message">
                    <span [style.font-weight]="'bold'">{{ forStaff ? 'Your message:' : 'Message from' }}</span><span [style.font-weight]="500"> {{ wil.issuer.display_name }}</span><br>
                    <span [attr.notranslate]="wil.issuer_message ? true : null" style="user-select: text">{{ wil.issuer_message ? wil.issuer_message : 'No Message' }}</span>
                  </div>
                </div>
              </div>
            </app-pager>
          </ng-container>

          <ng-template #mobile>
            <app-pager [arrowPosition]="'-93px'" [isStaff]="true" >
              <div class="page-5" [attr.data-motion-translate]="(frameMotion$ | async).direction">
<!--                <app-travel-view-->
<!--                  [forStaff]="forStaff"-->
<!--                  [height]="'170px'"-->
<!--                  [pass]="pass"-->
<!--                ></app-travel-view>-->
              </div>
              <div class="page-6" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <div style="display: flex; justify-content: center">
                  <div class="message">
                    <span [style.font-weight]="'bold'">{{ forStaff ? 'Your message:' : 'Message from' }}</span><span notranslate [style.font-weight]="500"> {{ wil.issuer.display_name }}</span><br>
                    {{wil.issuer_message|json}}
                    <span [attr.notranslate]="wil.issuer_message ? true : null" style="user-select: text">{{ wil.issuer_message ? wil.issuer_message : 'No Message' }}</span>
                  </div>
                </div>
              </div>
            </app-pager>
          </ng-template>
        </ng-template>
      </div>

      <mat-divider *ngIf="!data?.kioskMode"></mat-divider>
    </div>
    <div class="pass-card-footer" *ngIf="(forStaff || data?.kioskMode) && !isModal">
      <div class="student-footer"></div>
      <div class="student-text"> {{ studentText }} </div>
    </div>

  </div>

  <div
    class="student-footer-info"
    *ngIf="forStaff && isModal && showStudentInfoBlock"
    [style.marginTop]="'58px'"
  >
<!--    <app-student-passes [pass]="pass" [profile]="wil.student"></app-student-passes>-->
  </div>
</div>

<ng-template #confirmDialogBody let-totalStudents="totalStudents" let-limitReachedStudents="limitReachedStudents">
  <div *ngIf="totalStudents > 1" class="ds-dialog-normal-text">
    <p *ngFor="let s of limitReachedStudents"><var>{{s.displayName}}: {{s.passLimit}}/{{s.passLimit}}</var> passes today</p>
  </div>

  <div *ngIf="totalStudents === 1" class="ds-dialog-normal-text">
    <span>If it's an emergency, you can override the limit.</span>
  </div>
</ng-template>

<ng-template let-alerts="alerts" #confirmDialogBodyVisibility>
  <ng-container *ngFor="let a of alerts">
    <div class="ds-dialog-title">
      <span>{{a.phrase}}</span>
    </div>

    <div class="ds-dialog-normal-text ds-mb-10">
      <p notranslate>{{a.students}}</p>
    </div>
  </ng-container>
</ng-template>
