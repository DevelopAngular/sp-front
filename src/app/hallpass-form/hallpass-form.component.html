<p-growl [(value)]="msgs" life="3000"></p-growl>

<div #studentForm>
  <div class="form">
    <app-type-selector class="center" (onChange)="updateType($event)"></app-type-selector>
    <div class="divider"></div>
      <app-student-search *ngIf="isStaff" class="studentSearch center" (onUpdate)="studentsUpdated($event)"></app-student-search>
      <div *ngIf="isStaff" class="divider"></div>
    <div class="center locs">
      <button mat-button class="clickRipple from" (click)="chooseLoc('from')">
        <div class="card" [style.background]="getGradient('from')">
          <div class="vcenter">
            <img *ngIf="fromIcon != ''" class="icon vcenter" [src]="fromIcon | resolveAsset">
            <div class="title vcenter">
              {{from_title}}
            </div>
          </div>
        </div>
      </button>

      <!-- <div class="type-arrows"> -->
        <img *ngIf="travelType == 'round_trip'" class="round-trip" [src]="'./assets/RT_Arrow.png' | resolveAsset">
        <img *ngIf="travelType == 'one_way'" class="one-way" [src]="'./assets/OW_Arrow.png' | resolveAsset">
      <!-- </div> -->

      <button mat-button class="clickRipple to" (click)="chooseLoc('to')">
        <div class="card" [style.background]="getGradient('to')">
          <div class="vcenter">
            <img *ngIf="toIcon != ''" class="icon vcenter" [src]="toIcon | resolveAsset">
            <div class="title vcenter">
              {{to_title}}
            </div>
          </div>
        </div>
      </button>
    </div>
    <div class="divider"></div>
    <div *ngIf="formState == 'to'">
      <div *ngIf="toState == 'pinnables'">
        <mat-grid-list class="grid center" cols="4" rowHeight="75px" gutterSize="15px">
          <mat-grid-tile *ngFor="let pinnable of pinnables | async">
            <app-pinnable [pinnable]="pinnable" (onSelectEvent)="pinnableSelected($event)"></app-pinnable>
          </mat-grid-tile>
        </mat-grid-list>
      </div>
      <div *ngIf="toState == 'category'">
        <app-location-table class="center" (onSelect)="locationChosen($event)" [setCategory]="toCategory"></app-location-table>
      </div>
    </div>
    <div *ngIf="formState == 'fields'">
      <div *ngIf="!toLocation.restricted || isStaff; else restrictedFields;" class="fields center">
        <div class="question">How much time do you need?
          <br><br>
          <div class="amount">
              <app-duration-picker (onChange)="updateDuration($event)"></app-duration-picker>
            </div>
        </div>

        <div *ngIf="isStaff" class="passType">
          <div>Is this pass mandatory?</div>
          <mat-slide-toggle (change)="updatePassType($event)"></mat-slide-toggle>
        </div>

        <button mat-button class="clickRipple request" (click)="determinePass()">
          <div class="card requestCard">
            <div class="cardElements c">
              <div class="mtitle">
                <div *ngIf="isStaff; else notStaffButton">
                  <div *ngIf="isMandatory; else notMandatoryButton">
                    Issue
                  </div>
                  <ng-template #notMandatoryButton>
                    Invite
                  </ng-template>
                </div>
                <ng-template #notStaffButton>
                  Make Pass
                </ng-template>
              </div>
              <img class="micon" [src]="'./assets/One_Arrow.png' | resolveAsset">
            </div>
          </div>
        </button>
      </div>
      <ng-template #restrictedFields>
        <div class="center">
          <textarea #messageInput class="message" matInput placeholder="Leave a message for the teacher such as when and why you want the pass. "></textarea>
          <button mat-button class="clickRipple request" (click)="newRequest(messageInput.value)">
            <div class="card requestCard">
              <div>
                <div class="mtitle">
                  Request Pass
                </div>
                <img class="micon" [src]="'./assets/One_Arrow.png' | resolveAsset">
              </div>
            </div>
          </button>
        </div>
      </ng-template>
    </div>
  </div>
</div>
