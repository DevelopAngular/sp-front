<p-growl [(value)]="msgs" life="3000"></p-growl>

<div #studentForm>
  <div class="form">
    <app-type-selector class="center" (onChange)="updateType($event)"></app-type-selector>
    <div class="divider"></div>
    <app-student-search *ngIf="isStaff" class="studentSearch center"
                        (onUpdate)="studentsUpdated($event)"></app-student-search>
    <div *ngIf="isStaff" class="divider"></div>
    <div class="center locs">
      <app-gradient-button
        class="location-button"
        [gradient]="fromGradient"
        [minWidth]="'150px'"
      [leftIcon]="fromIcon"
      (click)="chooseLoc('from')"
      >{{ from_title }}</app-gradient-button>

      <!-- <div class="type-arrows"> -->
      <img [class.hidden]="travelType != 'round_trip'" class="round-trip" [src]="'./assets/RT_Arrow.png' | resolveAsset">
      <img [class.hidden]="travelType != 'one_way'" class="one-way" [src]="'./assets/OW_Arrow.png' | resolveAsset">
      <!-- </div> -->

      <app-gradient-button
        class="location-button"
        [gradient]="toGradient"
        [minWidth]="'150px'"
        [leftIcon]="toIcon"
        (click)="chooseLoc('to')"
      >{{ to_title }}</app-gradient-button>

    </div>
    <div class="divider"></div>
    <div *ngIf="formState == 'to'">
      <div *ngIf="toState == 'pinnables'">
        <mat-grid-list class="grid center" cols="4" rowHeight="75px" gutterSize="15px">
          <mat-grid-tile *ngFor="let pinnable of pinnables | async">
            <app-pinnable [pinnable]="pinnable" (onSelectEvent)="pinnableSelected($event)"></app-pinnable>
          </mat-grid-tile>
        </mat-grid-list>
      </div>
      <div *ngIf="toState == 'category'">
        <app-location-table class="center" (onSelect)="locationChosen($event)"
                            [setCategory]="toCategory"></app-location-table>
      </div>
    </div>
    <div *ngIf="formState == 'fields'">
      <div *ngIf="!toLocation.restricted || isStaff; else restrictedFields;" class="fields center">
        <div class="question">How much time do you need?
          <br><br>
          <div class="amount">
            <app-duration-picker (onChange)="updateDuration($event)"></app-duration-picker>
          </div>
        </div>

        <div *ngIf="isStaff" class="passType">
          <div>Is this pass mandatory?</div>
          <mat-slide-toggle (change)="updatePassType($event)"></mat-slide-toggle>
        </div>

        <app-gradient-button
          [minWidth]="'150px'"
          [gradient]="'#7b7df1, #5e3fb6'"
          [rightIcon]="'./assets/One_Arrow.png'"
        (click)="determinePass()"
        >{{ isStaff ? (isMandatory ? 'Issue' : 'Invite') : 'Make Pass' }}</app-gradient-button>

      </div>
      <ng-template #restrictedFields>
        <div class="flex">
          <div class="grow"></div>
          <textarea #messageInput class="message" matInput
                    placeholder="Leave a message for the teacher such as when and why you want the pass. "></textarea>

          <app-gradient-button class="request-button"
                               [gradient]="'#7b7df1, #5e3fb6'"
                               [leftIcon]="'./assets/One_Arrow.png'"
                               (click)="newRequest(messageInput.value)">Request Pass</app-gradient-button>
          <div class="grow"></div>
        </div>
      </ng-template>
    </div>
  </div>
</div>
