<div class="wrapper" *ngIf="!!profile">
    <div class="student-card-container">
        <div class="content-container">
            <div class="sticky-container">
                <div class="left" #left (scroll)="scroll($event)" [style.height]="(schoolsLength$ | async) > 1 ? 'calc(100vh - 154px)' : 'calc(100vh - 104px)'">
                    <div class="left-header" [style.height]="isScrollable ? '97px' : '166px'" [style.box-shadow]="isScrollable ? '0 2px 4px 0 rgba(0, 0, 0, 0.1)' : 'none'">
                        <div class="back">
                            <app-round-button (buttonClick)="back()" [icon]="'Chevron Left'" [iconOffset]="3" [iconWidth]="15"></app-round-button>
                        </div>
                        <div class="avatar-content">
                            <div class="avatar" #avatar [ngClass]="{scbl: isScrollable}" #avatarContainer (mouseenter)="avatarContainer.hover = true" (mouseleave)="avatarContainer.hover = false">
                                <div class="loading-theme_blue-gray spinner" *ngIf="loadingProfilePicture | async">
                                    <mat-spinner style="color: #7f879d" [diameter]="30"></mat-spinner>
                                </div>
                                <div class="image" *ngIf="profile && profile.profile_picture; else d" [ngStyle]="{'background': 'url(' + profile.profile_picture + ') no-repeat left center/cover'}" [ngClass]="{scbl: isScrollable}"></div>
                                <ng-template #d>
                                    <img class="image" [src]="'./assets/Avatar Default.svg' | resolveAsset" alt="Avatar" [ngClass]="{scbl: isScrollable}">
                                </ng-template>
                            </div>
                            <div notranslate class="student-name" [style.font-size]="isScrollable ? '13px' : isLongName ? '18px' : '28px'">{{ profile?.display_name }}</div>
                        </div>
                        <div class="top-buttons">
                            <!--      <app-round-button [icon]="'Notifications'" (buttonClick)="openNotification()"></app-round-button>-->
                            <app-round-button style="margin-left: 13px" [icon]="'Dots'" (buttonClick)="openStudentSettings($event)"></app-round-button>
                        </div>
                    </div>

                    <div class="content">
                        <div class="student-passes-info" *ngIf="!(loadingPassesStats$ | async); else fakeStats">
                            <div class="card-info" [allowVarTag]="true" [customToolTip]="'The student had ' + '<var>' + (passesStats$ | async)?.past_passes_today + '</var>' + ((passesStats$ | async)?.past_passes_today === 1 ? ' pass' : ' passes') +  ' today.'" [nonDisappearing]="false"
                                [editable]="true">
                                <div class="title">{{ (passesStats$ | async)?.past_passes_today }}</div>
                                <div isolate class="subtitle">today</div>
                            </div>
                            <div class="card-info" [allowVarTag]="true" [customToolTip]="'The student had ' + '<var>' + (passesStats$ | async)?.past_passes_week + '</var>' + ((passesStats$ | async)?.past_passes_week === 1 ? ' pass' : ' passes') +  ' this week.'" [nonDisappearing]="false"
                                [editable]="true">
                                <div class="title">{{ (passesStats$ | async)?.past_passes_week }}</div>
                                <div isolate class="subtitle">this week</div>
                            </div>
                            <div class="card-info" customToolTip [contentTemplate]="tooltip" [nonDisappearing]="false" [editable]="true">
                                <ng-template #tooltip>
                                    <div class="ds-tooltip" style="max-width: 265px" [innerHTML]="'The student had ' + '<var>' + (passesStats$ | async)?.past_passes_month + '</var>' + ((passesStats$ | async)?.past_passes_month === 1 ? ' pass' : ' passes') + ' this month.'"></div>
                                </ng-template>
                                <div class="title">{{ (passesStats$ | async)?.past_passes_month }}</div>
                                <div isolate class="subtitle">this month</div>
                            </div>
                        </div>

                        <ng-template #fakeStats>
                            <div class="student-passes-info">
                                <div class="fake-card-stats fake-animate" *ngFor="let card of [1, 1, 1]"></div>
                            </div>
                        </ng-template>
                        <div class="forms">
                            <div class="form">
                                <div class="form-content-container">
                                    <div class="form-content">
                                        <div class="title">Status</div>
                                        <div class="status-value" [style.opacity]="'1'" style="cursor: pointer; text-transform: capitalize" [style.color]="profile && profile?.status === 'active' ? '#00B476' : (profile && profile?.status === 'disabled' ? '#7f879d' : '#6651F1')">{{ profile?.status }}
                                            <!-- <ng-template #tooltip>
                                            <div class="ds-tooltip" style="text-align: left">
                                                <div class="only-admin">ADMIN ONLY</div>
                                                Only admins are able to change the account status.
                                            </div>
                                        </ng-template> -->
                                        </div>
                                    </div>
                                    <div class="form-content">
                                        <div class="title">Last Sign-in
                                            <span class="support-icon" customToolTip="The last time a student was signed in and/or active on desktop or mobile."><img width="13px" [src]="'./assets/Support (Gray-200).svg' | resolveAsset"></span>
                                        </div>
                                        <div class="value">{{ profile?.last_active ? getLastActiveDate(profile?.last_active) : 'Hasn\'t signed in' }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form" style="flex-direction: column; align-items: flex-start">
                                <div class="form-content">
                                    <div [attr.nostranslate]="(getEmailOrUsername().toLowerCase() === 'email') ? null : true" class="title">{{ getEmailOrUsername() }}</div>
                                    <div notranslate class="value">{{ profileEmail }}</div>
                                </div>
                                <div class="form-content" [style.margin]="'20px 0'">
                                    <div class="title">Grade</div>
                                    <div class="value">{{ profile.grade_level || '-' }}</div>
                                </div>
                                <div class="form-content">
                                    <div class="title">ID</div>
                                    <div class="value">{{ profile.custom_id || '-' }}</div>
                                </div>
                                <div class="form-content" [style.margin]="'20px 0'">
                                    <div class="title">Account Type <span class="support-icon" customToolTip [contentTemplate]="text"><img width="13px" [src]="'./assets/Support (Gray-200).svg' | resolveAsset"></span></div>
                                    <ng-template #text>
                                        <div class="ds-tooltip" style="max-width: 290px">If an account signs in with a third-party such as Google or Clever, or is a Standard account and signs in with a dedicated SmartPass password.</div>
                                    </ng-template>
                                    <div class="value">{{ accountType }}</div>
                                    <!--                <app-select-role-->
                                    <!--                  [selectedRoles]="[{id: 1, role: 'Student', icon: './assets/Student (Navy).svg'}]"-->
                                    <!--                  [isAccessAdd]="false"-->
                                    <!--                  [cardsBackground]="'#FFFFFF'"-->
                                    <!--                ></app-select-role>-->
                                </div>

                                <div class="form-content">
                                    <div class="title">School</div>
                                    <div class="value" ignore>{{ profile?.school_name }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="scrolling-container" #right (scroll)="rightScroll($event)">
                <div class="header-container">
                    <div class="header">
                        <div class="buttons">
                            <div class="date-button" #dateButton customToolTip="Filter stats, passes, and reports" [nonDisappearing]="false" [editable]="true">
                                <app-date-button [date]="selectedDate" (buttonClick)="openDateFilter($event)"></app-date-button>
                            </div>
                        </div>
                    </div>

                    <div class="divider" style="padding: 0 40px">
                        <mat-divider style="border-color: #E2E6EC" *ngIf="isRightScroll"></mat-divider>
                    </div>

                </div>

                <div class="right">
                    <div class="content">
                        <div class="block">
                            <app-overview-container [title]="'Overview'" [icon]="'./assets/Overview (Navy).svg'" (clickFilter)="openFilter($event)">
                                <div class="info-cards" *ngIf="!(studentsStatsLoading$ | async); else fakeInfo">
                                    <div class="info-card" #created (mouseenter)="created.hovered = true" (mouseleave)="created.hovered = false">
                                        <div class="title">PASSES CREATED
                                            <span class="support-icon" (mouseenter)="created.destroyClose = true" *ngIf="created.hovered || created.destroyClose" (leave)="created.destroyClose = false" customToolTip [contentTemplate]="createdTemplate" [editable]="true" [nonDisappearing]="false">
                            <img width="13px" [src]="'./assets/Support (Gray-200).svg' | resolveAsset">
                          </span>
                                            <ng-template #createdTemplate>
                                                <div class="ds-tooltip" style="max-width: 270px">
                                                    Number of passes the student has had, including passes teachers have created.
                                                </div>
                                            </ng-template>
                                        </div>
                                        <div class="value" [innerHTML]="'<var>' + (studentStats$ | async)?.total_created_passes + '</var>' + ( (studentStats$ | async)?.total_created_passes === 1 ? ' pass' : ' passes')"></div>
                                    </div>
                                    <div class="info-card" #outOfClass (mouseenter)="outOfClass.hovered = true" (mouseleave)="outOfClass.hovered = false">
                                        <div class="title">TIME SPENT OUT OF CLASS
                                            <span class="support-icon" (mouseenter)="outOfClass.destroyClose = true" *ngIf="outOfClass.hovered || outOfClass.destroyClose" (leave)="outOfClass.destroyClose = false" customToolTip [contentTemplate]="outOfClassTemplate" [editable]="true" [nonDisappearing]="false">
                            <img width="13px" [src]="'./assets/Support (Gray-200).svg' | resolveAsset">
                          </span>
                                            <ng-template #outOfClassTemplate>
                                                <div class="ds-tooltip" style="max-width: 310px; text-align: left">
                                                    <div>Sum of all of the durations of passes.<br/></div>
                                                    <div style="color: #7f879d; margin-top: 5px">This includes time when the pass auto-ended, so the actual time out of class may be lower.</div>
                                                </div>
                                            </ng-template>
                                        </div>
                                        <div notranslate class="value">{{ secondToTime((studentStats$ | async)?.out_of_class_seconds) }}</div>
                                    </div>
                                    <div class="info-card" #overTime (mouseenter)="overTime.hovered = true" (mouseleave)="overTime.hovered = false">
                                        <div class="title">PASSES OVER TIME LIMIT
                                            <span class="support-icon" (mouseenter)="overTime.destroyClose = true" *ngIf="overTime.hovered || overTime.destroyClose" (leave)="overTime.destroyClose = false" customToolTip [contentTemplate]="overTimeTemplate" [editable]="true" [nonDisappearing]="false">
                            <img width="13px" [src]="'./assets/Support (Gray-200).svg' | resolveAsset">
                          </span>
                                            <ng-template #overTimeTemplate>
                                                <div class="ds-tooltip" style="max-width: 290px; text-align: left">
                                                    <div>Number of passes where the pass exceeded the time limit set for the pass.<br/></div>
                                                    <div style="color: #7f879d; margin-top: 5px">For example, if a pass is started for 5 minutes and the pass isn't ended in that time.</div>
                                                </div>
                                            </ng-template>
                                        </div>
                                        <div class="value" [innerHTML]="'<var>' + (studentStats$ | async)?.over_time_limit + '</var>' + ( (studentStats$ | async)?.over_time_limit === 1 ? ' pass' : ' passes')"></div>
                                    </div>
                                    <div class="info-card" #autoEnded (mouseenter)="autoEnded.hovered = true" (mouseleave)="autoEnded.hovered = false">
                                        <div class="title">PASSES AUTO-ENDED
                                            <span class="support-icon" (mouseenter)="autoEnded.destroyClose = true" *ngIf="autoEnded.hovered || autoEnded.destroyClose" (leave)="autoEnded.destroyClose = false" customToolTip [contentTemplate]="autoEndedTemplate" [nonDisappearing]="false" [editable]="true">
                            <img width="13px" [src]="'./assets/Support (Gray-200).svg' | resolveAsset">
                          </span>
                                            <ng-template #autoEndedTemplate>
                                                <div class="ds-tooltip" style="max-width: 275px; text-align: left">
                                                    <div>Number of passes automatically ended, likely where student forgot to end it.<br/></div>
                                                    <div style="color: #7f879d; margin-top: 5px">When pass time reaches zero, passes count up and are automatically ended after <span style="text-decoration-line: underline; text-decoration-style: dashed; text-decoration-color: #7f879d">{{ profile?.school_pass_buffer_time === 1 ? profile?.school_pass_buffer_time + ' minute.' : profile?.school_pass_buffer_time + ' minutes.' }}</span></div>
                                                </div>
                                            </ng-template>
                                        </div>
                                        <div class="value" [innerHTML]="'<var>' + (studentStats$ | async)?.auto_ended + '</var>' + ((studentStats$ | async)?.auto_ended === 1 ? ' pass' : ' passes')"></div>
                                    </div>
                                </div>

                                <ng-template #fakeInfo>
                                    <div class="info-cards">
                                        <div class="fake-card fake-animate" *ngFor="let pass of [1, 1, 1, 1]"></div>
                                    </div>
                                </ng-template>
                            </app-overview-container>
                        </div>
                        <div class="block" [style.margin-top]="'40px'">
                            <app-overview-container [title]="'Passes'" [icon]="'./assets/Passes (Navy).svg'" (clickFilter)="openFilter($event)">
                                <div class="block-container">
                                    <div class="info-cards" *ngIf="!(studentsStatsLoading$ | async); else fakePasses">
                                        <ng-container *ngIf="(studentStats$ | async) && (studentStats$ | async).expired_passes.length; else emptyPassState">
                                            <ng-container *ngFor="let pass of (studentStats$ | async)?.expired_passes; let i = index">
                                                <app-pass-tile *ngIf="i <= 5" [forFuture]="false" [fromPast]="true" [forStaff]="false" [pass]="pass" [profileImage]="false" [isMiniCard]="true" (tileSelected)="openPassCard($event)"></app-pass-tile>
                                                <app-pass-tile *ngIf="(i > 5 && isFullScreenPasses)" [forFuture]="false" [fromPast]="true" [forStaff]="false" [pass]="pass" [profileImage]="false" [isMiniCard]="true" (tileSelected)="openPassCard($event)"></app-pass-tile>
                                            </ng-container>
                                        </ng-container>
                                        <ng-template #emptyPassState>
                                            <div class="empty-state">
                                                <div class="icon">
                                                    <img width="59px" [src]="'./assets/Passes (Gray-400).svg' | resolveAsset">
                                                </div>
                                                <div class="title">No passes have been created yet.</div>
                                            </div>
                                        </ng-template>
                                    </div>

                                    <ng-template #fakePasses>
                                        <div class="info-cards">
                                            <div class="fake-pass fake-animate" *ngFor="let pass of [1, 1, 1, 1, 1, 1]"></div>
                                        </div>
                                    </ng-template>
                                    <div class="button">
                                        <app-gradient-button [style.margin-top]="'20px'" *ngIf="(studentStats$ | async) && (studentStats$ | async)?.total_created_passes > 6 && !(studentsStatsLoading$ | async)" [gradient]="'#FFFFFF, #FFFFFF'" [leftIcon]="isFullScreenPasses ? './assets/Chevron Up (Blue-Gray).svg' : './assets/Chevron Down (Blue-Gray).svg'"
                                            [textColor]="'#7f879d'" (buttonClick)="isFullScreenPasses = !isFullScreenPasses">{{ isFullScreenPasses ? 'Collapse' : 'See all ' + (studentStats$ | async)?.total_created_passes + ' passes' }}
                                        </app-gradient-button>
                                    </div>
                                </div>
                            </app-overview-container>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
