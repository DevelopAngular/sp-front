<div class="request-container">
  <div class="request-card-wrapper" [@scalePassCards]="scaleCardTrigger$ | async" #cardWrapper [style.background-image]="gradient" [style.height]="forStaff ? (isModal ? '400px': '451px') : '412px'" ondragstart="return false">

    <div class="resize-icon" *ngIf="!forStaff && fullScreenButton" [style.color]="request.color_profile.solid_color" appCrossPointerEventTarget (pointerClickEvent)="openBigPassCard()">
      <svg width="24px" height="24px" viewBox="0 0 24 24">
        <use [attr.xlink:href]="isOpenBigPass ? '#Resize Down' : '#Resize Up'"></use>
      </svg>
    </div>

    <div class="pass-card-header">
      <div class="header-content">
        <div class="header-info">
          <img  class="pass-card-header-icon" [src]="request.icon | resolveAsset">
          <div class="pass-card-header-text">
            {{ request.destination.title }}
            <div class="card-subtitle" *ngIf="fromPast || forFuture">
              {{ ((request.request_time && forFuture)?formatDateTime(request.request_time):(forStaff?'Pass for Now':'')) }}
            </div>
          </div>
        </div>

        <div [ngClass]="iconClass">
          <app-icon-button *ngIf="!activeTeacherPin" [srcString]="'./assets/' +((!forStaff && !forInput && !invalidDate) ? 'Delete' : (!forInput && (forStaff || invalidDate) ? 'Dots' : 'Chevron Left')) +' (Transparent).svg'" [onDarkShade]="true" [size]="20" (clickEvent)="cancelRequest($event)"></app-icon-button>
          <app-icon-button *ngIf="activeTeacherPin" [srcString]="'./assets/Chevron Left (White).svg'" [onDarkShade]="true" [size]="20" (clickEvent)="activeTeacherPin = false"></app-icon-button>
        </div>

      </div>

      <mat-divider></mat-divider>
    </div>

    <div class="request-card-content" *ngIf="!isModal && !kioskModeRestricted">
      <div class="duration-picker">
        <app-traveltype-picker
          [width]="(request.destination.travel_types.length < 2 ? '106px' : '185px')"
          [height]="'28px'"
          (onSelect)="selectedTravelType=$event"
          [choices]="request.destination.travel_types"
          [altColor]="request.color_profile.solid_color"
        ></app-traveltype-picker>
        <app-duration-picker *ngIf="forInput" (onChange)="selectedDuration=$event"  [maxDuration]="(request.destination.max_allowed_time?request.destination.max_allowed_time:15)"></app-duration-picker>
      </div>
      <div class="button">
        <app-card-button (onClick)="newRequest()" [disabled]="performingAction" [width]="'269px'" [height]="'79px'" [gradientColor]="request.color_profile.gradient_color">
          <div class="request-button-content">
            <mat-spinner *ngIf="performingAction" [color]="'accent'" [diameter]="35"></mat-spinner>
            <div *ngIf="!performingAction" class="request-pass-content-text">Send Request</div>
            <img *ngIf="!performingAction"  class="button-icon-right" [src]="'./assets/SP Arrow (White).svg' | resolveAsset">
          </div>
        </app-card-button>
      </div>
    </div>

    <div class="request-card-content-modal" *ngIf="isModal || kioskModeRestricted">
      <div class="student-view" [@.disabled]="activeTeacherPin" *ngIf="!forStaff">

        <div class="content-container" *ngIf="!activeTeacherPin; else teacherPin">
          <div class="center-block">
            <app-pager *ngIf="!forInput" [arrowPosition]="'-93px'" [isStaff]="false">
              <div class="page-1" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <app-duration-picker *ngIf="forInput;" (onChange)="selectedDuration=$event"  [maxDuration]="(request.destination.max_allowed_time?request.destination.max_allowed_time:15)"></app-duration-picker>
                <app-travel-view *ngIf="!forInput" [pass]="request" [shrink]="true"></app-travel-view>
              </div>
              <div class="page-2" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <div class="page-2-wrapper">
                  <div [ngClass]="isIOSTablet ? 'ios-margin-left' : ''" class="message" [style.height]="(forInput?'70px':'155px')">
                    <span [style.font-weight]="'bold'">{{ (forStaff?'Message from ' +studentName +':':'Your message:') }}</span><br>
                    <span style="user-select: text">{{ (request.attachment_message===''?'No message':request.attachment_message) }}</span>
                    <div *ngIf="request.status==='declined'">
                      <br>
                      <span [style.font-weight]="'bold'">Message from {{ request.teacher.last_name }}:</span><br>
                      <span style="user-select: text">{{ (request.declined_message===''?'No message':request.declined_message) }}</span> <!-- deny_message -->
                    </div>
                  </div>
                  <app-card-button *ngIf="forInput" (onClick)="editMessage()" class="edit-button" [width]="'110px'" [height]="'35px'" [gradientColor]="request.color_profile.gradient_color">
                    <div class="button-content">Edit Message</div>
                  </app-card-button>
                </div>
              </div>

              <div class="page-5" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <app-duration-picker *ngIf="forInput; else noInput;" (onChange)="selectedDuration=$event"  [maxDuration]="(request.destination.max_allowed_time?request.destination.max_allowed_time:15)"></app-duration-picker>
                <ng-template #noInput>
                  <app-travel-view *ngIf="!screenService.isDeviceLargeExtra" [pass]="request" [shrink]="true"></app-travel-view>
                  <app-travel-view *ngIf="screenService.isDeviceLargeExtra" [height]="'164px'" [pass]="request" [shrink]="true"></app-travel-view>
                </ng-template>
              </div>

              <div class="page-6" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <div class="page-2-wrapper">
                  <div [ngClass]="isIOSTablet ? 'ios-margin-left' : ''" class="message" [style.height]="(forInput?'70px':'155px')">
                    <span [style.font-weight]="'bold'">{{(forStaff?'Message from ' +studentName +':':'Your message:')}}</span><br>
                    <span style="user-select: text">{{ (request.attachment_message===''?'No message':request.attachment_message) }}</span>
                    <div *ngIf="request.status==='declined'">
                      <br>
                      <span [style.font-weight]="'bold'">Message from {{request.teacher.last_name}}:</span><br>
                      <span style="user-select: text">{{ (request.declined_message===''?'No message':request.declined_message) }}</span> <!-- deny_message -->
                    </div>
                  </div>
                  <app-card-button *ngIf="forInput" (onClick)="editMessage()" class="edit-button" [width]="'110px'" [height]="'35px'" [gradientColor]="request.color_profile.gradient_color">
                    <div class="button-content">Edit Message</div>
                  </app-card-button>
                </div>
              </div>
            </app-pager>

          </div>

          <mat-divider *ngIf="((request.status==='accepted' || invalidDate) && !forInput && !forStaff) || (request.status!=='pending' && forStaff)"></mat-divider>

          <div class="bottom-block">
            <div *ngIf="request.status==='pending' && !invalidDate; else noTeachPin"
                 (mouseenter)="onHover(desc, title)"
                 (mouseleave)="onLeave(desc)">
              <app-card-button
                [width]="'297px'"
                [height]="'81px'"
                [gradientColor]="request.color_profile.gradient_color"
                (onClick)="goToPin()">
                <div class="resend-button-content">
                  <div class="center-content">
                    <div class="resend-button-content-title" style="display: flex; align-items: center;">
                      <img style="margin-right: 10px" width="18" height="18" [src]="'./assets/Lock dots (White).svg' | resolveAsset" alt="Lock">
                      Enter Teacher Pin
                    </div>
                    <div class="description-container" #title>
                      <div class="shadow left-radius" [ngStyle]="{'box-shadow': '0px 0px 17px 10px ' + solidColorRgba2}" [style.background]="request.gradient_color.split(',')[1]" [style.left]="0" *ngIf="leftTextShadow"></div>
                      <div class="description-title" #desc [style.margin-left]="filteredTeachers.length > 1 ? '0px' : '15px'">
                        Pass Request sent to:
                        <span style="width: 5px"></span>
                        <span style="font-weight: normal; font-size: 17px" *ngFor="let teacher of filteredTeachers; let i = index">
                            <span style="margin-right: 3px">{{ teacher.display_name + (i === filteredTeachers.length - 1 ? '' : ', ') }}</span>
                          </span>
                      </div>
                      <div class="shadow right-radius" [ngStyle]="{'box-shadow': '0px 0px 30px 20px ' + solidColorRgba}" [style.background]="request.gradient_color.split(',')[0]" *ngIf="!removeShadow" [style.right]="0"></div>
                    </div>
                  </div>
                </div>
              </app-card-button>
            </div>
            <ng-template #noTeachPin>
              <div class="request-description">
                <img class="request-description-icon" [src]="'./assets/Lock (White).svg' | resolveAsset">
                <div class="request-description-text">
                  Pass Request sent to: <br>
                  <span style="font-weight: normal; font-size: 17px" *ngFor="let teacher of filteredTeachers; let i = index">
                  {{ teacher.display_name + (i === filteredTeachers.length - 1 ? '' : ', ') }}
                </span>
                </div>
              </div>
            </ng-template>
            <div *ngIf="request.status==='accepted'">
              <div class="request-description">
                <img class="request-description-icon" [src]="'./assets/Arrow (White).svg' | resolveAsset">
                <div class="request-description-text">
                  Pass Request accepted by {{ request.teacher.last_name }}
                </div>
              </div>
            </div>

<!--            <div *ngIf="request.status==='declined'">-->
<!--              <app-card-button *ngIf="!forStaff" [disabled]="performingAction" (onClick)="changeDate()" [width]="'297px'" [height]="'81px'" [gradientColor]="request.color_profile.gradient_color">-->
<!--                <div class="resend-button-content">-->
<!--                  <mat-spinner *ngIf="performingAction" [color]="'accent'" [diameter]="35"></mat-spinner>-->
<!--                  <div *ngIf="!performingAction" class="resend-button-content-title">{{ (forFuture?'Change Date & Time':'Resend Request') }}</div>-->
<!--                  <div class="resend-button-content-subtitle">Pass Request Denied</div>-->
<!--                </div>-->
<!--              </app-card-button>-->
<!--            </div>-->
          </div>
        </div>

        <ng-template #teacherPin>
          <div class="teacher-pin">
            <app-teacher-pin-student (pinResult)="handlePinResult($event)" [request]="request" [requestId]="request.id"></app-teacher-pin-student>
          </div>
        </ng-template>

      </div>

      <div class="teacher-view" *ngIf="forStaff">
        <div class="pager" style="height: 210px">
          <app-pager *ngIf="!forInput" [arrowPosition]="'-93px'" [isStaff]="true">
            <div class="page-1" [attr.data-motion-translate]="(frameMotion$ | async).direction">
              <app-duration-picker *ngIf="forInput; else noInput;" (onChange)="selectedDuration=$event"  [maxDuration]="(request.destination.max_allowed_time?request.destination.max_allowed_time:15)"></app-duration-picker>
              <ng-template #noInput>
                <app-travel-view [height]="'164px'" [pass]="request" [shrink]="true"></app-travel-view>
              </ng-template>
            </div>
            <div class="page-2" [attr.data-motion-translate]="(frameMotion$ | async).direction">
              <div class="page-2-wrapper">
                <div [ngClass]="isIOSTablet ? 'ios-margin-left' : ''"  class="message" [style.height]="(forInput?'70px':'164px')">
                  <span [style.font-weight]="'bold'">{{ (forStaff?'Message from ' +studentName +':':'Your message:') }}</span><br>
                  <span style="user-select: text">{{ (request.attachment_message===''?'No message':request.attachment_message) }}</span>
                  <div *ngIf="request.status==='declined'">
                    <br>
                    <span [style.font-weight]="'bold'">Message from {{ request.teacher.last_name }}:</span><br>
                    <span style="user-select: text">{{ (request.declined_message===''?'No message':request.declined_message) }}</span> <!-- deny_message -->
                  </div>
                </div>
                <app-card-button *ngIf="forInput" (onClick)="editMessage()" class="edit-button" [width]="'110px'" [height]="'35px'" [gradientColor]="request.color_profile.gradient_color">
                  <div class="button-content">Edit Message</div>
                </app-card-button>
              </div>
            </div>

            <div class="page-5" [attr.data-motion-translate]="(frameMotion$ | async).direction">
              <app-duration-picker *ngIf="forInput; else noInput;" (onChange)="selectedDuration=$event"  [maxDuration]="(request.destination.max_allowed_time?request.destination.max_allowed_time:15)"></app-duration-picker>
              <ng-template #noInput>
                <app-travel-view [height]="'164px'" [pass]="request" [shrink]="true"></app-travel-view>
              </ng-template>
            </div>

            <div class="page-6" [attr.data-motion-translate]="(frameMotion$ | async).direction">
              <div class="page-2-wrapper">
                <div [ngClass]="isIOSTablet ? 'ios-margin-left' : ''"  class="message" [style.height]="(forInput?'70px':'164px')">
                  <span [style.font-weight]="'bold'">{{(forStaff?'Message from ' +studentName +':':'Your message:')}}</span><br>
                  <span style="user-select: text">{{ (request.attachment_message===''?'No message':request.attachment_message) }}</span>
                  <div *ngIf="request.status==='declined'">
                    <br>
                    <span [style.font-weight]="'bold'">Message from {{request.teacher.last_name}}:</span><br>
                    <span style="user-select: text">{{ (request.declined_message===''?'No message':request.declined_message) }}</span> <!-- deny_message -->
                  </div>
                </div>
                <app-card-button *ngIf="forInput" (onClick)="editMessage()" class="edit-button" [width]="'110px'" [height]="'35px'" [gradientColor]="request.color_profile.gradient_color">
                  <div class="button-content">Edit Message</div>
                </app-card-button>
              </div>
            </div>
          </app-pager>
        </div>
        <div *ngIf="forInput; else staffNoInput">
          Something went wrong
        </div>
        <ng-template #staffNoInput>
          <div *ngIf="request.status=='pending'; else staffNotPending" style="margin-bottom: 12px; width: 295px;">
            <app-card-button (onClick)="approveRequest()"
                             *ngIf="!invalidDate; else CDate"
                             [disabled]="performingAction"
                             [width]="'295px'"
                             [height]="'81px'"
                             [gradientColor]="request.color_profile.gradient_color"
            >
              <div class="resend-button-content">
                <mat-spinner *ngIf="performingAction" [color]="'accent'" [diameter]="35"></mat-spinner>
                <div *ngIf="!performingAction" class="resend-button-content-title">Approve Pass Request</div>
                <div class="resend-button-content-subtitle">{{ (request.duration/60) +' min - Received ' +formatDateTime(request.created, true) }}</div>
              </div>
            </app-card-button>
            <ng-template #CDate>
              <app-card-button [width]="'295px'" [height]="'81px'" (onClick)="changeDate()" [gradientColor]="request.color_profile.gradient_color">
                <div class="resend-button-content">
                  <div class="resend-button-content-title">Change Date & Time</div>
                  <div class="resend-button-content-subtitle">Resend Pass Request to Student</div>
                </div>
              </app-card-button>
            </ng-template>
          </div>
          <ng-template #staffNotPending>
            <div>
              <app-pager [page]="2">
                <div class="page-1 teacher-details" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                  <span class="bold">Pass Request Sent</span><span class="smaller"><br>to {{ studentName }}<br><br>{{ formatDateTime(request.created) }}</span>
                </div>
                <div class="page-2 teacher-details" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                  <span class="bold">Pass Request {{ status }}</span><span class="smaller"><br>by {{ teacherName }}<br><br>{{ formatDateTime(request.last_updated) }}</span>
                </div>

                <div class="page-5 teacher-details" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                  <span class="bold">Pass Request Sent</span><span class="smaller"><br>to {{studentName}}<br><br>{{formatDateTime(request.created)}}</span>
                </div>
                <div class="page-6 teacher-details" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                  <span class="bold">Pass Request {{ status }}</span><span class="smaller"><br>by {{teacherName}}<br><br>{{formatDateTime(request.last_updated)}}</span>
                </div>
              </app-pager>
            </div>
          </ng-template>
        </ng-template>
      </div>

      <div class="request-card-footer" *ngIf="forStaff && !isModal">
        <div class="student-footer"></div>
        <div class="student-text"> {{ request.student.display_name }} </div>
      </div>
    </div>

  </div>

  <div
    class="student-footer-info"
    *ngIf="forStaff && isModal"
    [style.marginTop]="'58px'"
    >
    <app-student-passes [pass]="request" [profile]="request.student"></app-student-passes>
  </div>
</div>

<svg style="display: none">
  <defs>
    <symbol id="Resize Up">
      <g stroke="none" stroke-width="1" fill-rule="evenodd">
        <g transform="translate(-597.000000, -104.000000)" fill="currentColor" fill-rule="nonzero">
          <g transform="translate(585.000000, 92.000000)">
            <path d="M21.8701363,25.0004801 C21.5850418,25.0089749 21.3144532,25.1281246 21.1156963,25.3326869 L14.2099981,32.2383019 L14.2099981,27.2059044 C14.2140599,26.9092893 14.0978727,26.6236631 13.8879102,26.4141068 C13.6779476,26.2045506 13.3920948,26.0889148 13.0954845,26.0935475 C12.4902687,26.1030079 12.0069755,26.6006788 12.0152636,27.2059044 L12.0152636,34.7202073 C11.9562715,35.0703776 12.0703577,35.4274495 12.3214576,35.6785463 C12.5725575,35.9296431 12.9296336,36.0437279 13.2798082,35.9847366 L20.7942017,35.9847366 C21.1899517,35.9903334 21.5580586,35.7824116 21.7575669,35.4405885 C21.9570753,35.0987654 21.9570753,34.6759997 21.7575669,34.3341766 C21.5580586,33.9923535 21.1899517,33.7844317 20.7942017,33.7900286 L15.7617435,33.7900286 L22.6674416,26.884414 C22.9919994,26.5689342 23.0895865,26.0865653 22.9131801,25.6697389 C22.7367738,25.2529125 22.3225627,24.987138 21.8701363,25.0004801 Z M34.8708368,12.0004579 C34.8299462,12.0017503 34.7891598,12.005328 34.7486687,12.0111741 L27.2106697,12.0111741 C26.8149181,12.0055776 26.4468099,12.2134873 26.2473008,12.5552904 C26.0477917,12.8970936 26.0477917,13.3198346 26.2473008,13.6616378 C26.4468099,14.003441 26.8149181,14.2113506 27.2106697,14.2057541 L32.2431469,14.2057541 L25.3374224,21.1109663 C25.0507475,21.3861855 24.9352683,21.7948701 25.0355212,22.1794047 C25.1357741,22.5639393 25.4360933,22.8642362 25.8206565,22.9644815 C26.2052196,23.0647268 26.6139345,22.9492561 26.8891741,22.6626024 L33.7948982,15.7573903 L33.7948982,20.7894943 C33.7893012,21.1852165 33.9972263,21.5532974 34.3390549,21.7527917 C34.6808834,21.952286 35.1036558,21.952286 35.4454843,21.7527917 C35.7873128,21.5532974 35.9952379,21.1852165 35.989641,20.7894943 L35.989641,13.2477684 C36.033876,12.9280053 35.93507,12.6049865 35.719518,12.364676 C35.5039659,12.1243656 35.1935341,11.9911414 34.8708368,12.0004579 L34.8708368,12.0004579 Z"></path>
          </g>
        </g>
      </g>
    </symbol>
    <symbol id="Resize Down">
      <g stroke="none" stroke-width="1" fill-rule="evenodd">
        <g transform="translate(-597.000000, -104.000000)" fill="currentColor" fill-rule="nonzero">
          <g transform="translate(585.000000, 92.000000)">
            <path d="M34.8701363,12.0004801 C34.5850418,12.0089749 34.3144532,12.1281246 34.1156963,12.3326869 L27.2099981,19.2383019 L27.2099981,14.2059044 C27.2140599,13.9092893 27.0978727,13.6236631 26.8879102,13.4141068 C26.6779476,13.2045506 26.3920948,13.0889148 26.0954845,13.0935475 C25.4902687,13.1030079 25.0069755,13.6006788 25.0152636,14.2059044 L25.0152636,21.7202073 C24.9562715,22.0703776 25.0703577,22.4274495 25.3214576,22.6785463 C25.5725575,22.9296431 25.9296336,23.0437279 26.2798082,22.9847366 L33.7942017,22.9847366 C34.1899517,22.9903334 34.5580586,22.7824116 34.7575669,22.4405885 C34.9570753,22.0987654 34.9570753,21.6759997 34.7575669,21.3341766 C34.5580586,20.9923535 34.1899517,20.7844317 33.7942017,20.7900286 L28.7617435,20.7900286 L35.6674416,13.884414 C35.9919994,13.5689342 36.0895865,13.0865653 35.9131801,12.6697389 C35.7367738,12.2529125 35.3225627,11.987138 34.8701363,12.0004801 Z M21.8708368,25.0004579 C21.8299462,25.0017503 21.7891598,25.005328 21.7486687,25.0111741 L14.2106697,25.0111741 C13.8149181,25.0055776 13.4468099,25.2134873 13.2473008,25.5552904 C13.0477917,25.8970936 13.0477917,26.3198346 13.2473008,26.6616378 C13.4468099,27.003441 13.8149181,27.2113506 14.2106697,27.2057541 L19.2431469,27.2057541 L12.3374224,34.1109663 C12.0507475,34.3861855 11.9352683,34.7948701 12.0355212,35.1794047 C12.1357741,35.5639393 12.4360933,35.8642362 12.8206565,35.9644815 C13.2052196,36.0647268 13.6139345,35.9492561 13.8891741,35.6626024 L20.7948982,28.7573903 L20.7948982,33.7894943 C20.7893012,34.1852165 20.9972263,34.5532974 21.3390549,34.7527917 C21.6808834,34.952286 22.1036558,34.952286 22.4454843,34.7527917 C22.7873128,34.5532974 22.9952379,34.1852165 22.989641,33.7894943 L22.989641,26.2477684 C23.033876,25.9280053 22.93507,25.6049865 22.719518,25.364676 C22.5039659,25.1243656 22.1935341,24.9911414 21.8708368,25.0004579 L21.8708368,25.0004579 Z"></path>
          </g>
        </g>
      </g>
    </symbol>
  </defs>
</svg>

<ng-template #PassLimitOverride>
  <div class="ds-dialog-normal-text">
    <span>If it's an emergency, you can override the limit.</span>
  </div>
</ng-template>
