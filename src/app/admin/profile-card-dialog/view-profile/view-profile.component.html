<div class="profile-card-dialog-container" *ngIf="data['setupLink'] else profileCard">
    <div class="card-header" [style.background-color]="'#00B476'">
        <div class="back-button ds-flex-center-center" (click)="back()">
            <img [src]="'./assets/Back Button (Blue-White).svg'" alt="Back Button (Blue-White).svg">
        </div>
        <div class="ds-flex-center-center ds-dialog-title-white">
            <img class="role-icon" [ngClass]="{'gsuite': this.layout === 'gSuiteSettings'}" [src]="'./assets/Chain (White).svg'" alt="header-icon">
            <span>Accounts Set-up Link</span>
        </div>
    </div>

</div>

<ng-template #profileCard>
    <div class="profile-card-dialog-container" *ngIf="page == 1">
        <!-- Disables card when some async stuffs occur-->
        <div class="disabled-state loading-theme_light-gray spinner" *ngIf="disabledState">
            <mat-spinner [diameter]="100" [color]="'accent'"></mat-spinner>
        </div>
        <!-- end -->
        <div class="card-header" #header>
            <div class="background-header" [attr.data-motion-opacity]="(frameMotion$ | async).direction"></div>
            <div class="back-button ds-flex-center-center" (click)="back()">
                <img *ngIf="!isEdit" [src]="'./assets/Back Button (Blue-White).svg'" alt="Back Button (Blue-White).svg">
                <div class="cancel" *ngIf="isEdit">Cancel</div>
            </div>
            <div class="ds-flex-center-center ds-dialog-title" style="z-index: 10" [attr.data-motion-translate]="(frameMotion$ | async).direction">
                <!--        <img class="role-icon" [ngClass]="{'gsuite': this.layout === 'gSuiteSettings'}"  [src]="headerIcon" alt="header-icon">-->
                <span notranslate>{{user.display_name}}</span>

            </div>
            <div class="status-button" #status>
              <app-gradient-button (buttonClick)="goToStudent()" *ngIf="user.isStudent()" [size]="'editable'" [leftImageWidth]="'17px'" [text]="''" [gradient]="'#FFFFFF'"
                                   [leftIcon]="'./assets/External Link (Navy).svg'"
                                   [linkType]="'_blank'">
              </app-gradient-button>

              <!-- <app-icon-button *ngIf="!isEdit" [srcString]="'Dots'" [size]="17" (clickEvent)="openStatusPopup()"></app-icon-button> -->
                <app-gradient-button *ngIf="isEdit" (buttonClick)="save()">Save</app-gradient-button>
            </div>
        </div>

        <div class="content-scrollable-box" [attr.data-motion-translate]="(frameMotion$ | async).direction">

            <div class="block">
                <div class="email-info">
                    <div class="title">Email/username</div>
                    <div notranslate class="subtitle" style="white-space: normal; word-break: break-word; width: 280px">{{ user.primary_email.replace('@spnx.local', '') }}</div>
                </div>
                <div class="avatar-info">
                    <div class="avatar" #avatarContainer (mouseenter)="avatarContainer.hover = true" (mouseleave)="avatarContainer.hover = false">
                        <div class="loading-theme_blue-gray spinner" *ngIf="loadingProfilePicture | async">
                            <mat-spinner style="color: #7f879d" [diameter]="30"></mat-spinner>
                        </div>
                        <div *ngIf="user.profile_picture; else d" [ngStyle]="{'background': 'url(' + user.profile_picture + ') no-repeat left center/cover', width: '88px', height: '88px'}"></div>
                        <ng-template #d>
                            <img width="88" height="88" [src]="'./assets/Avatar Default.svg' | resolveAsset" alt="Avatar">
                        </ng-template>
                        <div *ngIf="avatarContainer.hover" class="hover-backdrop" (click)="!user.profile_picture ? editWindow($event) : null" [style.cursor]="!user.profile_picture ? 'pointer' : 'normal'"></div>
                        <div class="buttons" *ngIf="!(loadingProfilePicture | async)">
                            <img #editIcon (click)="editWindow($event)" *ngIf="avatarContainer.hover || isOpenAvatarDialog" class="add-avatar" [style.top]="!user.profile_picture ? '30px' : '15px'" [src]="'./assets/' + (user.profile_picture ? 'Edit' : 'Add') + ' Avatar (White).svg' | resolveAsset"
                                alt="add">
                            <img (click)="deleteAvatar()" *ngIf="avatarContainer.hover && user.profile_picture" [src]="'./assets/Delete (White).svg'" [style.bottom]="'15px'" class="add-avatar" alt="Delete">
                        </div>

                    </div>
                    <div class="status" [customToolTip]="statusDescriptions[profileStatusActive] || null" (click)="openStatusPopup()" [style.color]="profileStatusActive === 'active' ? '#00B476' : profileStatusActive === 'suspended' ? '#6651F1' : '#7f879d'">
                        {{ profileStatusActive }}
                        <span><img width="9px" [src]="'./assets/Chevron Down (' + (profileStatusActive === 'active' ? 'Jade' : (profileStatusActive === 'disabled' ? 'Blue-Gray' : 'Soft-Blue')) + ').svg' | resolveAsset" alt=""></span>
                    </div>
                </div>
                <div class="role-info">
                    <app-select-role [selectedRoles]="userRoles" [isAccessAdd]="isAccessAdd" (onSelect)="userRoles = $event"></app-select-role>
                </div>

                <div class="role-info" *ngIf="user.isAssistant()">
                    <div class="title">Act on behalf of</div>
                    <app-sp-search [selectedOptions]="assistantFor" [chipsMode]="true" [focused]="true" [role]="'_profile_teacher'" [dummyRoleText]="'teachers'" [rollUpAfterSelection]="true" [cancelButton]="true" [placeholder]="'Search teachers'" (onUpdate)="assistantForUpdate$.next($event)"></app-sp-search>
                </div>

                <div class="role-info" style="width: 100%" *ngIf="user.isTeacher()">
                    <div class="title">Rooms</div>
                    <app-sp-search [width]="'254px'" [listMaxHeight]="'unset'" [focused]="true" [placeholder]="'Search rooms'" [searchTarget]="'rooms'" [cancelButton]="true" [displaySelectedTitle]="false" [chipsMode]="true" [selectedOptions]="teacherRooms" (onUpdate)="teacherRooms = $event"></app-sp-search>
                </div>

                <div class="grade-info" *ngIf="user.isStudent() || user.isAdmin()">
                    <div class="title">Grade</div>
                    <div class="subtitle" *ngIf="user.isStudent()" style="white-space: normal; word-break: break-word; width: 280px">{{ user.grade_level || '-' }}</div>
                    <div class="subtitle" *ngIf="user.isAdmin()">
                        <app-gradient-button (buttonClick)="openGradeLevel()" [size]="'small'" [rightIconWidth]="'16px'" [gradient]="'#00B476, #00B476'" [rightIcon]="'./assets/External Link (White).svg'">
                            Add Grade Level
                        </app-gradient-button>
                    </div>
                </div>
                <div class="id-number-info">
                    <div class="title">ID</div>
                    <div class="subtitle" *ngIf="!user.isAdmin()" style="white-space: normal; word-break: break-word; width: 280px">{{ user.custom_id || '-' }}</div>
                    <div class="subtitle" *ngIf="user.isAdmin()">
                        <app-gradient-button (buttonClick)="openIDNumber()" [size]="'small'" [rightIconWidth]="'16px'" [gradient]="'#00B476, #00B476'" [rightIcon]="'./assets/External Link (White).svg'">
                            Add ID Number
                        </app-gradient-button>
                    </div>
                </div>

            </div>
            <mat-divider *ngIf="profilePermissions.student.length"></mat-divider>
            <div class="block" *ngIf="profilePermissions.student.length">
                <div class="title">Student Permissions</div>
                <div class="permissions">
                    <div class="permission" *ngFor="let permission of profilePermissions.student">
                        <div class="subtitle" style="display: flex; align-items: center">
                            <!--              <img width="17" style="margin-right: 7px" [src]="'./assets/' + permission.icon + ' (Blue-Gray).svg'" alt="11">-->
                            {{ permission.label }}
                        </div>
                        <app-toggle-input style="width: auto" [form]="permissionsForm" [controlName]="permission.permission" [controlSize]="'small'" [delimiter]="false"></app-toggle-input>
                    </div>
                </div>
            </div>

<!--            <div *ngIf="user.isStudent()" class="block pass-limit-card" style="flex-direction: column; cursor: pointer; margin: 0px 20px;-->
<!--      background: #F5F6F8;-->
<!--      padding: 20px 10px;-->
<!--      border-radius: 10px;" [ngClass]="{ 'pass-limit-enabled': !studentPassLimit?.isUnlimited }" (click)="passLimitsEmit.emit()">-->
<!--              <div class="card ds-flex-center-between">-->
<!--                <div class="ds-flex-center-center label" [style.align-items]="!!studentPassLimit?.description ? 'flex-start !important' : 'center'">-->
<!--                  <div class="icon" style="background-color: #5E4FED;-->
<!--      width: 26px;-->
<!--      height: 26px;-->
<!--      border-radius: 5px;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      justify-content: center;">-->
<!--                    <img style="position: absolute; z-index: 10;" height="14px" [src]="'./assets/Pass Limit (White).svg' | resolveAsset" alt="">-->
<!--                  </div>-->
<!--                  <div class="ds-ml-10" style="display: flex; flex-direction: column">-->
<!--                <span class="ds-dialog-heading" style="display: flex; padding-bottom: 0; font-weight: 600 !important;">-->
<!--                  Pass Limit-->
<!--                  <div style="display: inline" customToolTip [contentTemplate]="passLimitLearnMore">-->
<!--                    <img-->
<!--                      class="support-icon"-->
<!--                      style="width: 13px"-->
<!--                      [src]="'./assets/Support (Gray-200).svg' | resolveAsset">-->
<!--                  </div>-->
<!--                  <ng-template #passLimitLearnMore>-->
<!--                    <div class="ds-tooltip">-->
<!--                      <span>-->
<!--                        Limit the number of passes students can have per day.-->
<!--                        <a href="https://www.smartpass.app/passlimits" target="_blank" style="color: white"> Learn more</a>-->
<!--                      </span>-->
<!--                    </div>-->
<!--                  </ng-template>-->
<!--                </span>-->
<!--                    <div *ngIf="studentPassLimit?.passLimit" class="ds-flex-column" style="display: flex; gap: 3px; margin-top: 3px;">-->
<!--                          <span-->
<!--                            style="font-size: 15px !important; font-weight: 500 !important;"-->
<!--                            [ngClass]="{ 'pass-limit-counter': true, 'individual-limit': studentPassLimit.isIndividual, 'school-limit': !studentPassLimit.isIndividual }">-->
<!--                            {{studentPassLimit.passLimit === -2 ? "Unlimited" : studentPassLimit.passLimit}} passes/day-->
<!--                          </span>-->
<!--                      <span class="ds-dialog-normal-text" style="font-weight: 400 !important;" *ngIf="studentPassLimit.description && studentPassLimit.isIndividual">{{studentPassLimit.description}}</span>-->
<!--                    </div>-->
<!--                  </div>-->
<!--                </div>-->
<!--                <app-gradient-button-->
<!--                  *ngIf="!studentPassLimit?.passLimit"-->
<!--                  size="tiny"-->
<!--                  gradient="#6651F1"-->
<!--                  textColor="#FFFFFF"-->
<!--                >-->
<!--                  Set up-->
<!--                </app-gradient-button>-->
<!--                <img *ngIf="studentPassLimit?.passLimit"-->
<!--                     style="width: 16px; height: 16px"-->
<!--                     [src]="'./assets/Chevron Right (Gray).svg' | resolveAsset" alt="">-->
<!--              </div>-->
<!--            </div>-->

            <mat-divider></mat-divider>
            <div class="block">
                <div class="descriptions">
                    <div class="info">
                        <div class="title">Last sign-in</div>
                        <div notranslate class="subtitle">{{ profile['Last sign-in'] }}</div>
                    </div>
                    <div class="info">
                        <div class="title">Type</div>
                        <div class="subtitle">{{ profile['Type'] }}</div>
                    </div>
                    <div class="info" *ngIf="profile['Type'] === 'Standard'">
                        <div class="title">Password</div>
                        <div class="subtitle"><span style="text-decoration: underline; cursor: pointer" (click)="nextStep.emit('password')">Change</span></div>
                    </div>
                </div>
            </div>

            <mat-divider *ngIf="user.isTeacher()"></mat-divider>
            <div class="block" *ngIf="user.isTeacher()">
                <div class="permissions">
                    <div class="title">Teacher Permissions</div>
                    <div class="permission" *ngFor="let permission of profilePermissions.teacher">
                        <div class="subtitle" style="display: flex; align-items: center">
                            <img width="17" style="margin-right: 7px" [src]="'./assets/' + permission.icon + ' (' + (getIsPermissionOn(permission.permission) ? 'Jade' : 'Blue-Gray') + ').svg'" alt="11"> {{ permission.label }}
                        </div>
                        <app-toggle-input style="width: auto" [form]="permissionsForm" [controlName]="permission.permission" [controlSize]="'small'" [delimiter]="false"></app-toggle-input>
                    </div>
                </div>
            </div>
            <mat-divider *ngIf="user.isAdmin()"></mat-divider>
            <div class="block" *ngIf="user.isAdmin()">
                <div class="permissions">
                    <div class="title">Admin Permissions</div>
                    <div class="permission" *ngFor="let permission of profilePermissions.admin">
                        <div class="subtitle" style="display: flex; align-items: center">
                            <img width="17" style="margin-right: 7px" [src]="'./assets/' + permission.icon + ' (' + (getIsPermissionOn(permission.permission) ? 'Jade' : 'Blue-Gray') + ').svg'" alt="11"> {{ permission.label }}
                        </div>
                        <app-toggle-input style="width: auto" [form]="permissionsForm" [controlName]="permission.permission" [controlSize]="'small'" [delimiter]="false"></app-toggle-input>
                    </div>
                </div>
            </div>
            <div class="block" *ngIf="user.isAssistant()">
                <div class="permissions">
                    <div class="title">Assistant Permissions</div>
                    <div class="permission" *ngFor="let permission of profilePermissions.assistant">
                        <div class="subtitle" style="display: flex; align-items: center">
                            <img width="17" style="margin-right: 7px" [src]="'./assets/' + permission.icon + ' (' + (getIsPermissionOn(permission.permission) ? 'Jade' : 'Blue-Gray') + ').svg'" alt="11"> {{ permission.label }}
                        </div>
                        <app-toggle-input style="width: auto" [form]="permissionsForm" [controlName]="permission.permission" [controlSize]="'small'" [delimiter]="false"></app-toggle-input>
                    </div>
                </div>
            </div>
        </div>
    </div>

</ng-template>
<div *ngIf="page == 2">
    <app-grade-levels [page]="2" (backEmit)="page = 1"></app-grade-levels>
</div>
<div *ngIf="page == 3">
    <app-id-numbers [page]="2" (backEmit)="page = 1"></app-id-numbers>
</div>
