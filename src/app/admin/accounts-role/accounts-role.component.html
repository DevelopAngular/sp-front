<div class="host" appSafariScroll>
  <div class="accounts-role-wrapper"  *ngIf="role !== 'g_suite'">
    <div class="header-wrapper">
      <div class="card card__top-bar ds-flex-start-between ds-w-100">
        <div class="ds-flex-start-start ds-h-100">

          <div class="back-button" *ngIf="!(dataTableEditState | async) && role !== 'g_suite'">
            <!--<app-back-button routerLink="/admin/accounts"></app-back-button>-->
            <app-icon-button [size]="17" [srcString]="'Chevron Left'" (clickEvent)="router.navigate(['/admin/accounts'])"></app-icon-button>
          </div>
          <div class="ds-h-100 ds-mx-10" *ngIf="(dataTableEditState | async)"></div>
          <div class="ds-mt-20 ds-mx-5" [ngSwitch]="role">
            <div *ngSwitchCase="'_profile_admin'">
              <div class="card_header ds-mb-10">
                <img [src]="darkTheme.getIcon({
                  iconName: 'Admin',
                  darkFill: 'White',
                  lightFill: 'Navy'
                }) | resolveAsset" alt="Settings.svg">
                <span [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">Administrators</span>
              </div>
              <div *ngIf="!(dataTableEditState | async)" class="card_title tooltip-container">

                <img [src]="'./assets/Info (Blue-Gray).svg' | resolveAsset"
                     [matTooltip]="'An administrator has a high-level look at the school, configures passes, and views/generates reports.'"
                     matTooltipClass="tooltip"
                     alt="">
                <span [style.font-weight]="'bold'">{{(countAccount$.admin | async)}} user{{(countAccount$.admin | async)> 1 ? 's' : ''}}</span><br>
                <div class="arrow-down-container">
                  <div class="arrow-down"></div>
                </div>
              </div>
              <div  *ngIf="(dataTableEditState | async)" class="card_title">
                <span [style.font-weight]="'bold'">{{selectedUsers.length}} Selected</span>
              </div>
            </div>
            <div *ngSwitchCase="'_profile_teacher'">
              <div class="card_header ds-mb-10">
                <img [src]="darkTheme.getIcon({
                  iconName: 'Teacher',
                  darkFill: 'White',
                  lightFill: 'Navy'
                }) | resolveAsset" alt="Settings.svg">
                <span [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">Teachers</span>
              </div>
              <div *ngIf="!(dataTableEditState | async)" class="card_title tooltip-container">
                <img [src]="'./assets/Info (Blue-Gray).svg' | resolveAsset"
                     [matTooltip]="' A teacher has a room or multiple rooms where students can create passes to.'+
  '                    A teacher can create passes, view hall monitor activity, and manage passes in his/her room.'"
                     matTooltipClass="tooltip"
                     alt="">
                <span [style.font-weight]="'bold'">{{(countAccount$.teacher | async)}} user{{(countAccount$.teacher | async)> 1 ? 's' : ''}}</span><br>
                <div class="arrow-down-container">
                  <div class="arrow-down"></div>
                </div>
              </div>
              <div  *ngIf="(dataTableEditState | async)" class="card_title">
                <span [style.font-weight]="'bold'">{{selectedUsers.length}} Selected</span>
              </div>
            </div>
            <div *ngSwitchCase="'_profile_student'">
              <div class="card_header ds-mb-10">
                <img [src]="darkTheme.getIcon({
                  iconName: 'Student',
                  darkFill: 'White',
                  lightFill: 'Navy'
                }) | resolveAsset" alt="Settings.svg">
                <span [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">Students</span>
              </div>
              <div  *ngIf="!(dataTableEditState | async)" class="card_title tooltip-container">
                <img [src]="'./assets/Info (Blue-Gray).svg' | resolveAsset"
                     [matTooltip]="'A student can create passes, schedule passes for the future,'+
  '                and send pass requests to teachers.'"
                     matTooltipClass="tooltip"
                     alt="">
                <span [style.font-weight]="'bold'">{{(countAccount$.student | async) }} user{{(countAccount$.student | async) > 1 ? 's' : ''}}</span><br>
                <div class="arrow-down-container">
                  <div class="arrow-down"></div>
                </div>
              </div>
              <div  *ngIf="(dataTableEditState | async)" class="card_title">
                <span [style.font-weight]="'bold'">{{selectedUsers.length}} Selected</span>
              </div>
            </div>
            <div *ngSwitchCase="'_profile_assistant'">
              <div class="card_header ds-mb-10">
                <img [src]="darkTheme.getIcon({
                  iconName: 'Assistant',
                  darkFill: 'White',
                  lightFill: 'Navy'
                }) | resolveAsset" alt="Settings.svg">
                <span [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">Assistants</span>
              </div>
              <div *ngIf="!(dataTableEditState | async)" class="card_title tooltip-container">
                <img [src]="'./assets/Info (Blue-Gray).svg' | resolveAsset"
                     [matTooltip]="'A secretary or substitute teacher acts as a certain teacher when they sign-in.' +
                      'They can manage passes in his/her room and create passes as that teacher.'"
                     matTooltipClass="tooltip"
                     alt="">
                <span [style.font-weight]="'bold'">{{(countAccount$.assistant | async)}} user{{(countAccount$.assistant | async) > 1 ? 's' : ''}}</span><br>
                <div class="arrow-down-container">
                  <div class="arrow-down"></div>
                </div>
              </div>
              <div  *ngIf="(dataTableEditState | async)" class="card_title">
                <span [style.font-weight]="'bold'">{{selectedUsers.length}} Selected</span>
              </div>
            </div>
          </div>
        </div>
        <div class="tool-panel ds-mx-20 ds-my-10" *ngIf="(dataTableEditState | async)">

          <div class="ds-flex-center-start">

            <div class="ds-p-10"  *ngIf="role === '_profile_admin' || role === '_profile_teacher'">
              <app-gradient-button
                      [size]="'small'"
                      [disabled]="!selectedUsers.length"
                      [cursor]="'pointer'"
                      [minHeight]="'32px'"
                      [width]="'215px'"
                      [hoverColor]="'#F4F4F4'"
                      [fontSize]="'14px'"
                      [gradient]="'#F4F4F4, #F4F4F4'"
                      [textColor]="'#1F195E'"
                      (buttonClick)="showProfileCard(selectedUsers[0], true)">
                <span>Bulk Permissions</span>
              </app-gradient-button>
            </div>

            <div class="ds-p-10" *ngIf="role !== '_all'">
              <app-gradient-button
                      *ngIf="!bulkSignInStatus"
                      [size]="'small'"
                      [disabled]="!selectedUsers.length"
                      [cursor]="'pointer'"
                      [minHeight]="'32px'"
                      [width]="'215px'"
                      [fontSize]="'14px'"
                      (buttonClick)="promptConfirmation($event.target, 'enable_sign_in')">
                <span>Enable sign-in</span>
              </app-gradient-button>
              <app-gradient-button
                      *ngIf="bulkSignInStatus"
                      [size]="'small'"
                      [disabled]="!selectedUsers.length"
                      [cursor]="'pointer'"
                      [minHeight]="'32px'"
                      [width]="'215px'"
                      [fontSize]="'14px'"
                      [gradient]="'#001115, #033294'"
                      [hoverColor]="'#022F68'"
                      (buttonClick)="promptConfirmation($event.target, 'disable_sign_in')">
                <span>Disable sign-in</span>
              </app-gradient-button>
            </div>

            <div class="ds-p-10">
              <app-gradient-button
                      [size]="'small'"
                      [disabled]="!selectedUsers.length"
                      [cursor]="'pointer'"
                      [minHeight]="'32px'"
                      [width]="'280px'"
                      [fontSize]="'14px'"
                      [gradient]="'#DA2370, #FB434A'"
                      [hoverColor]="'#DA2370'"
                      (buttonClick)="promptConfirmation($event.target, 'delete_from_profile')">
                <span>{{ role === '_all' ? 'Delete Account & Data' : 'Remove from Group' }}</span>
              </app-gradient-button>
            </div>
            <div class="ds-mx-10">
              <app-gradient-button
                      [size]="'medium'"
                      [cursor]="'pointer'"
                      [gradient]="'#F4F4F4, #F4F4F4'"
                      [hoverColor]="'#F4F4F4'"
                      [textColor]="'#1F194E'"
                      (buttonClick)="dataTableEditState.next(!dataTableEditState.value)">
                <div class="ds-flex-center-center">
                  <span *ngIf="dataTableEditState.value">Done</span>
                </div>
              </app-gradient-button>
            </div>
          </div>
        </div>
        <div class="ds-flex-center-between ds-mr-20 ds-my-10" style="flex: 1 1 auto" *ngIf="!(dataTableEditState | async) && role !== 'g_suite'">
          <div class="ds-flex-center-end ds-w-100">
            <div class="ds-mx-10">
              <app-round-input
                      [initialValue]="initialSearchString"
                      [minWidth]="'230px'"
                      [width]="'230px'"
                      [type]="'text'"
                      [pending$]="pending$"
                      [placeholder]="'Search'"
                      (ontextupdate)="findRelevantAccounts($event)"
                      [isSearch]="true">
              </app-round-input>
            </div>

            <div class="ds-mx-10" *ngIf="role !== '_all'">

              <app-gradient-button
                      [size]="'medium'"
                      [cursor]="'pointer'"
                      [leftIcon]="'./assets/Plus (White).svg'"
                      (buttonClick)="addUser()">
                <div class="ds-flex-center-center">
                  <span>Add</span>
                </div>
              </app-gradient-button>
            </div>
            <div class="ds-mx-10">

              <app-gradient-button
                      [size]="'medium'"
                      [cursor]="'pointer'"
                      [gradient]="'#F4F4F4, #F4F4F4'"
                      [hoverColor]="'#F4F4F4'"
                      [textColor]="'#1F194E'"
                      (buttonClick)="dataTableEditState.next(!dataTableEditState.value)">
                <div class="ds-flex-center-center">
                  <span *ngIf="!dataTableEditState.value">Edit</span>
                </div>
              </app-gradient-button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table" *ngIf="role !== 'g_suite'">
      <div class="loading-theme_blue-gray spinner ds-flex-center-center" *ngIf="(isLoading$ | async) && !userList.length">
        <mat-spinner [diameter]="50" [color]="'primary'"></mat-spinner>
      </div>
      <div *ngIf="!userList.length && (noUsersDummyVisibility | async)" class="loading-theme_blue-gray spinner ds-flex-center-center">
        <!--<h1 [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7F879D'})" *ngIf="placeholder">No matches found.</h1>-->
        <div *ngIf="placeholder" class="ds-flex-center-center ds-flex-column ds-pt-25 ds-mt-25" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7F879D'})">
          <img [src]="'./assets/emptyStates/no-matches-found.svg'" class="ds-py-25 ds-mt-25 ds-mb-10" alt="no-users.svg">
          <div class="ds-empty-text-title">No users found</div>
          <p class="ds-my-10 ds-empty-text-info" style="text-align: center;">Spellcheck? Wrong profile?</p>
        </div>
      </div>

      <div *ngIf="!userList.length && (isLoaded$ | async)" class="ds-flex-center-center ds-flex-column ds-pt-25 ds-mt-25" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7F879D'})">
        <img [src]="'./assets/emptyStates/no-users.svg'" class="ds-py-25 ds-mt-25 ds-mb-10" alt="no-users.svg">
        <div class="ds-empty-text-title">No Users</div>
        <p class="ds-my-10 ds-empty-text-info" style="text-align: center;">Add users one-by-one above or set up G Suite <br>
          syncing to automatically add users to this profile.</p>
      </div>
      <div *ngIf="userList.length && placeholder" style="display: flex; flex-direction: column; flex: 1 1 auto; width: 100%;">
        <div class="column-settings">
          <app-icon-button class="options-icon" [srcString]="'Options'" [size]="16" (clickEvent)="showColumnSettings($event)"></app-icon-button>
          <!--<img draggable="false" width="20" [src]="darkTheme.getIcon({iconName: 'Options', lightFill: 'Blue-Gray'}) | resolveAsset" alt="Options (Navy).svg" (click)="showColumnSettings($event)">-->
        </div>
        <app-data-table
          class="ds-my-10"
          [scrollableAreaName]="'Table' + role"
          [data]="userList"
          [isCheckbox]="dataTableEditState"
          [marginTopStickyHeader]="'147px'"
          [textColor]="'#7E879D'"
          [disallowHover]="role === '_all' && !(dataTableEditState | async)"
          [displayedColumns]="dataTableHeadersToDisplay"
          (selectedCell)="findProfileByRole($event)"
          (selectedRow)="showProfileCard($event)"
          (selectedUsers)="setSelected($event)"
          >
        </app-data-table>
      </div>
    </div>
  </div>

  <div class="gsuite-wrapper" *ngIf="role === 'g_suite'">
    <div class="header-wrapper" [style.background-color]="darkTheme.getBackground('default')">
      <div class="gsuite-header" [style.background-color]="darkTheme.getBackground('high', true)">
        <div class="header-content">
          <div class="left-block">
            <div class="back-button" routerLink="/admin/accounts">
              <app-icon-button [size]="17" [srcString]="'Chevron Left'" (clickEvent)="router.navigate(['/admin/accounts'])"></app-icon-button>
            </div>
            <div class="title-content">
              <img width="50" height="50" [src]="'./assets/google/google_logo.svg' | resolveAsset" alt="">
              <div class="title" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">
                G Suite


                <div *ngIf="GSuiteOrgs.last_successful_sync" class="small-text" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">Last sync: {{syncing.enabled ? 'Syncing' + syncing.syncingDots: formatDate(GSuiteOrgs.last_successful_sync) }}</div>
                <div *ngIf="!GSuiteOrgs.last_successful_sync" class="small-text" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">Last sync: - </div>
              </div>
            </div>
          </div>

          <div class="right-block" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">
<!--            <div class="count-accounts">{{ GSuiteOrgs.num_accounts + ' accounts' }}</div>-->
            <div class="count-accounts">
              <span *ngIf="GSuiteOrgs.num_accounts">{{ GSuiteOrgs.num_accounts }} </span>
              <span *ngIf="!GSuiteOrgs.num_accounts">-</span>
              <span> accounts</span></div>
            <div class="text">syncing from G Suite</div>
          </div>
        </div>
      </div>
    </div>

    <div class="gsuite-content">
      <div class="content-wrapper">

        <div class="left-side">
          <div class="sync">
            <div class="title" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">Sync</div>
            <div *ngIf="GSuiteOrgs.last_successful_sync && GSuiteOrgs.next_sync; else empty" class="subtitle" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">
              <div>Last sync: {{syncing.enabled ? 'Syncing' + syncing.syncingDots: formatDate(GSuiteOrgs.last_successful_sync) }}</div>
              <div>Next scheduled sync: {{ syncing.enabled ? 'Syncing' + syncing.syncingDots: formatDate(GSuiteOrgs.next_sync) }}</div>
            </div>
            <ng-template #empty>
              <div class="subtitle" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">
                <div>Last sync: -</div>
                <div>Next scheduled sync: -</div>
              </div>
            </ng-template>
            <div class="info" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">
              Syncs happen automatically every four hours, but you can also sync manually now.
            </div>
            <app-gradient-button
                    [size]="'small'"
                    [gradient]="'#022F68, #2F66AB'"
                    [hoverColor]="'#022F68'"
                    [fontSize]="'13px'"
                    [cursor]="'pointer'"
                    (buttonClick)="syncNow()"
            >
              <span>
                Sync Now
              </span>
            </app-gradient-button>
          </div>

          <div class="about-sync">
            <div class="about-title" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#1E194F'})">About G Suite Sync</div>
            <div class="about-content" [style.color]="darkTheme.getColor({dark: '#FFFFFF', white: '#7f879d'})">
              When a new account is created in G Suite,
              if they are added to a syncing organizational unit they will automatically be added to the specified SmartPass Group.
              <br/><br/>
              Sync automatically updates existing user details.
            </div>
          </div>

          <app-privacy-card
            [title]="'Note on Privacy'"
            [infoText]="'We take student privacy very seriously, continuously working with schools to make sure student data is kept safe and secure.'"
            [leftIcon]="'./assets/Shield (Blue-Gray).svg'"
            [buttonColor]="'#FFFFFF, #7F879D'"
            [buttonLink]="'https://www.smartpass.app/privacy'"
          ></app-privacy-card>

        </div>

        <div class="right-side">
          <app-account-groups
            (accountsToSync)="syncOrgUnits($event)"
          ></app-account-groups>
        </div>
      </div>
    </div>
  </div>
</div>
