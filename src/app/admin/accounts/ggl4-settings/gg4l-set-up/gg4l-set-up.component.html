<div class="wrapper">
  <div class="header" *ngIf="dialogAction === 'gg4l'; else cleverHeader">
    <div class="background-header" [attr.data-motion-opacity]="(frameMotion$ | async).direction"></div>
    <img class="back-button" *ngIf="schoolSyncInfo.login_provider || !schoolSyncInfo.is_gg4l_enabled" [src]="'./assets/Back Button (White).svg' | resolveAsset" (click)="close()">
    <div class="back-button" *ngIf="!schoolSyncInfo.login_provider && this.selectedProvider" (click)="close()">Cancel</div>
    <img width="21" height="21" style="z-index: 10" [attr.data-motion-translate]="(frameMotion$ | async).direction" [src]="'./assets/GG4L (White).svg' | resolveAsset" alt="Options">
    <div class="ds-dialog-title-white"
         [style.margin-left]="'12px'"
         [style.z-index]="10"
         [attr.data-motion-translate]="(frameMotion$ | async).direction"
    >Set-up</div>
    <div class="save-button" *ngIf="!schoolSyncInfo.login_provider && this.selectedProvider">
      <app-gradient-button
        [width]="'85px'"
        [minHeight]="'30px'"
        [fontSize]="'14px'"
        [cursor]="'pointer'"
        (buttonClick)="setProvider()"
      >
        <span *ngIf="true">Save</span>
        <mat-spinner *ngIf="false" [color]="'accent'" [diameter]="30"></mat-spinner>
      </app-gradient-button>
    </div>
  </div>
  <ng-template #cleverHeader>
    <div class="header">
      <div class="background-header" [style.background]="'#4274F6'" [attr.data-motion-opacity]="(frameMotion$ | async).direction"></div>
      <img class="back-button" [src]="'./assets/Back Button (White).svg' | resolveAsset" (click)="close()">
      <div class="ds-dialog-title-white"
           [style.margin-left]="'12px'"
           [style.z-index]="10"
           [attr.data-motion-translate]="(frameMotion$ | async).direction"
      >Clever Set-up</div>
      <div class="right-button">
        <app-icon-button [srcString]="'Dots'" [onDarkShade]="true" [size]="17" (clickEvent)="openConsentMenu($event)"></app-icon-button>
      </div>
    </div>
  </ng-template>

  <div class="content" [attr.data-motion-translate]="(frameMotion$ | async).direction">
    <div class="no-connect" *ngIf="(!schoolSyncInfo.is_gg4l_enabled && dialogAction === 'gg4l') || (!schoolSyncInfo.is_clever_enabled && dialogAction === 'clever')">
      <div class="top-block">
        <div class="title">Add SmartPass in {{ integrationName }}</div>
        <div class="subtitle">You’ll need to be a {{ integrationName }} admin to add an application.</div>
        <div class="button">
          <app-gradient-button
            [gradient]="!isClever ? '#5352E4, #5352E4' : '#4274F6, #4274F6'"
            [leftIcon]="'./assets/External Link (White).svg'"
            (buttonClick)="openLink(dialogAction === 'gg4l' ? 'https://www.smartpass.app/gg4l-open' : 'https://www.smartpass.app/clever-open')"
          >Open {{ dialogAction === 'gg4l' ? integrationName + ' Connect' : integrationName }}</app-gradient-button>
        </div>
      </div>
      <div class="center-block">
        <div class="title">Wait for approval from SmartPass</div>
        <div class="subtitle">
          After you add SmartPass in {{ integrationName }}, we’ll start processing your activation request immediately. It might take a few hours, but we’ll send you an email once accounts are ready.
        </div>
      </div>
    </div>

    <div class="content-enabled" *ngIf="(schoolSyncInfo.is_gg4l_enabled && dialogAction === 'gg4l') || (schoolSyncInfo.is_clever_enabled && dialogAction === 'clever')">
      <ng-container *ngIf="dialogAction === 'gg4l'; else clever">
        <div class="active-top">
          <div class="left">
            <div class="sync-title">Last Sync</div>
            <div class="sync-subtitle">{{ formatDate(gg4lSyncInfo.last_successful_sync) }}</div>
            <div style="color: #00B476">Successful</div>
          </div>
          <div class="right">
            <div class="sync-title">Accounts synced</div>
            <div class="sync-subtitle">{{ gg4lSyncInfo.num_students }} students</div>
            <div class="sync-subtitle">{{ gg4lSyncInfo.num_teachers }} teachers</div>
            <div class="sync-subtitle">{{ gg4lSyncInfo.num_admins }} admins</div>
          </div>
        </div>
        <div class="active-top">
          <div class="left">
            <div class="sync-title">Next sync</div>
            <div class="sync-subtitle">{{ formatDate(gg4lSyncInfo.next_sync) }}</div>
          </div>
        </div>
      </ng-container>

      <ng-template #clever>
        <ng-container *ngIf="!(syncLoading$ | async)">
          <div class="active-top">
            <div class="left">
              <div class="sync-title">Last Sync</div>
              <div class="sync-subtitle">{{ formatDate(getLastSyncDate(cleverSyncInfo)) }}</div>
              <div [ngStyle]="{'color': getLastSyncMessage(cleverSyncInfo) === 'Successful' ? '#00B476' : '#E32C66'}">
                {{ getLastSyncMessage(cleverSyncInfo) }}
              </div>
            </div>
            <div class="right">
              <div class="sync-title">Accounts synced</div>
              <div class="sync-subtitle">{{ cleverSyncInfo.num_students }} students</div>
              <div class="sync-subtitle">{{ cleverSyncInfo.num_teachers }} teachers</div>
              <div class="sync-subtitle">{{ cleverSyncInfo.num_admins }} admins</div>
            </div>
          </div>
          <div class="active-top">
            <div class="left">
              <div class="sync-title">Next sync</div>
              <div class="sync-subtitle">{{ formatDate(cleverSyncInfo.next_sync) }}</div>
              <div style="margin-top: 15px">
                <app-gradient-button [gradient]="'#4274F6, #4274F6'" (buttonClick)="syncing()">Sync now</app-gradient-button>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="syncLoading$ | async">
          <div class="syncing-container">
            <div class="syncing-spin-wrapper">
              <mat-spinner [style.color]="'#4274F6'" [diameter]="50"></mat-spinner>
              <div class="syncing-title">Sync in Progress...</div>
            </div>
          </div>
        </ng-container>
      </ng-template>
      <mat-divider [style.margin-top]="'34px'" *ngIf="dialogAction === 'gg4l'"></mat-divider>

      <div class="center" *ngIf="dialogAction === 'gg4l'">
        <div class="prov-title">Sign-in authentication (SSO)</div>
        <div class="prov-subtitle">How should users be authenticated when they sign in to SmartPass?</div>
        <div class="buttons" style="width: 228px" [matTooltip]="schoolSyncInfo.is_gg4l_enabled && !!schoolSyncInfo.login_provider ? 'Contact us to change your sign-in provider.' : null"
             matTooltipClass="tooltip">
          <app-restriction-picker
            [choices]="['Sign in with Google', 'GG4L \n Passport']"
            [selectedChoice]="normalizeProvider"
            [disabled]="schoolSyncInfo.is_gg4l_enabled && !!schoolSyncInfo.login_provider"
            [padding]="15"
            [width]="228"
            [height]="48"
            (result)="selectProvider($event)"
          ></app-restriction-picker>
        </div>

      </div>
    </div>
  </div>
  <div class="footer">
    <mat-divider></mat-divider>

    <div class="footer-content">
        <div class="link" style="color: #7f879d">Need more help?</div>
        <div class="link"><a style="color: #7f879d" href="https://www.smartpass.app/gg4l" target="_blank">See tutorial</a></div>
        <div class="link"><a style="color: #7f879d" href="https://www.smartpass.app/meeting" target="_blank">Schedule a call</a></div>
    </div>
  </div>
</div>
