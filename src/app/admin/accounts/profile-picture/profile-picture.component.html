<div class="wrapper">
  <div class="heading" #header>
    <div class="back-button">
      <img (click)="back()" *ngIf="page !== 3 && page !== 4" [src]="'./assets/Back Button (Light-Gray).svg'" alt="Back Button (Blue-White).svg">
      <div class="cancel" (click)="openConfirm($event)" *ngIf="page === 3">Cancel</div>
    </div>
    <div class="ds-dialog-title-white ds-flex-center-center">
      <img [src]="'./assets/Pictures (White).svg' | resolveAsset" width="20" height="20" alt="(White).svg" class="ds-mr-10">
      <span>Profile Pictures</span>
    </div>
    <div class="save-button"
         [matTooltip]="(!uploadingProgress.images.complete || !uploadingProgress.csv.complete) && page === 2 ? 'Make sure to add the profile files and the map file before uploading!' : null"
         matTooltipClass="tooltip">
      <app-gradient-button
        *ngIf="page !== 3 && page !== 5"
        [disabled]="(!uploadingProgress.images.complete || !uploadingProgress.csv.complete) && page === 2"
        [size]="'small'"
        [gradient]="'#FFFFFF, #FFFFFF'"
        [hoverColor]="'#FCFDFF'"
        [textColor]="'#07ABC3'"
        [cursor]="'pointer'"
        (buttonClick)="nextPage()"
      >
        <div class="ds-flex-center-start">
          <span>
           {{ page === 4 ? 'Done' : 'Upload' }}
          </span>
        </div>
      </app-gradient-button>
      <div class="incomplete" *ngIf="false">Incomplete</div>
    </div>
  </div>

  <div class="content">
    <div class="page" *ngIf="page === 1">
      <div class="center-content">
        <img style="margin-right: 15px" [src]="'./assets/emptyStates/upload-file.svg' | resolveAsset">
        <div style="margin-top: 35px"  class="ds-dialog-heading">Add Profile Pictures</div>
        <div class="subtitle">Quickly add profile pictures for all your users with an image map from your SIS.</div>
        <app-gradient-button
          [gradient]="'#07ABC3, #07ABC3'"
          [hoverColor]="'#07ABC3'"
          [rightIcon]="'./assets/Chevron Right (White).svg'"
          (buttonClick)="nextPage()"
        >Continue
        </app-gradient-button>
      </div>
    </div>

    <div class="page" *ngIf="page === 2">
      <div class="step-wrapper">
        <div class="step-container">
          <div class="step-number">1</div>
          <div class="step">
            <div class="ds-dialog-heading">Add profile picture files</div>
            <div class="description">
              Supported image types: JPEG, PNG <br/>
              You can also upload a zip file that contains the images.
            </div>
          </div>
        </div>
        <div class="button">
          <app-gradient-button
            *ngIf="!uploadingProgress.images.inProcess && !uploadingProgress.images.complete"
            [gradient]="'#7F879D, #7F879D'"
            [hoverColor]="'#7F879D'"
            [leftIcon]="'./assets/Zip (White).svg'"
            (buttonClick)="zip.click()"
          >Choose files
          </app-gradient-button>
          <input type="file" multiple [formControl]="form.get('images')"  #zip style="display: none"/>

          <div class="upload" *ngIf="uploadingProgress.images.inProcess || uploadingProgress.images.complete">
            <mat-spinner *ngIf="uploadingProgress.images.inProcess; else complete" [color]="'warn'" [diameter]="30"></mat-spinner>
            <ng-template #complete><img style="width: 16px" [src]="'./assets/Zip (White).svg' | resolveAsset"></ng-template>
            <div class="info"
                 [style.color]="uploadingProgress.images.inProcess ? '#7f879d' : '#FFFFFF'"
            >{{ uploadingProgress.images.inProcess ? 'Uploading' : imagesLength + ' images selected' }}</div>
          </div>
        </div>
      </div>

      <div class="step-wrapper">
        <div class="step-container">
          <div class="step-number">2</div>
          <div class="step">
            <div class="ds-dialog-heading">Step 1: Add map file</div>
            <div class="description">
              Upload an Excel spreadsheet or CSV containing the user ID number and the corresponding image file name.
            </div>
          </div>
        </div>
        <div class="buttons">
          <app-gradient-button
            [size]="'small'"
            [gradient]="'#F4F4F4, #F4F4F4'"
            [buttonLink]="'./assets/xlsx/SmartPass Picture Map.xlsx'"
            [linkType]="'_self'"
            [download]="true"
            [hoverColor]="'#F4F4F4'"
            [textColor]="'#1E194F'"
            [leftIcon]="'./assets/Download (Navy).svg'"
            [text]="'Download Template'"
            [cursor]="'pointer'"
          >
          </app-gradient-button>
          <app-gradient-button
            *ngIf="!uploadingProgress.csv.inProcess && !uploadingProgress.csv.complete"
            [gradient]="'#7F879D, #7F879D'"
            [hoverColor]="'#7F879D'"
            [leftIcon]="'./assets/XLSX (White).svg'"
            (buttonClick)="csvFile.click()"
          >Choose files
          </app-gradient-button>

          <div class="upload-map" *ngIf="uploadingProgress.csv.inProcess || uploadingProgress.csv.complete">
            <mat-spinner *ngIf="uploadingProgress.csv.inProcess; else complete" [color]="'warn'" [diameter]="30"></mat-spinner>
            <ng-template #complete>
              <img style="width: 16px" [src]="'./assets/XLSX (White).svg' | resolveAsset" alt="Check">
            </ng-template>
            <div class="info"
                 [ngClass]="{elips: uploadingProgress.csv.complete}"
                 [style.color]="uploadingProgress.csv.inProcess ? '#7f879d' : '#FFFFFF'"
            >{{ uploadingProgress.csv.inProcess ? 'Uploading' : selectedMapFile.name }}</div>
          </div>

          <input type="file" [formControl]="form.get('csvFile')"  #csvFile style="display: none"/>
        </div>
      </div>

    </div>

    <div class="page" *ngIf="page === 3">

      <div class="image-container">

        <svg width="124px" height="96px">
            <linearGradient id="lg" x1="0.5" y1="1" x2="0.5" y2="0">
              <stop offset="0%" stop-opacity="1" stop-color="#07ABC3">
                <animate attributeName="offset" values="0;1;" dur="5s" begin="0" fill="freeze"/>
              </stop>
              <stop offset="0%" stop-opacity="1" stop-color="#7f879d">
                <animate attributeName="offset" values="0;1;" dur="5s" begin="0" fill="freeze"/>
              </stop>
            </linearGradient>
          <path fill="url(#lg)" d="M9.53846154,0 C4.26846154,0 0,4.296 0,9.6 L0,86.4 C0,91.704 4.26846154,96 9.53846154,96 L114.461538,96 C119.731538,96 124,91.704 124,86.4 L124,9.6 C124,4.296 119.731538,0 114.461538,0 L9.53846154,0 Z M100.153846,14.4 C105.423846,14.4 109.692308,18.696 109.692308,24 C109.692308,29.304 105.423846,33.6 100.153846,33.6 C94.8838462,33.6 90.6153846,29.304 90.6153846,24 C90.6153846,18.696 94.8838462,14.4 100.153846,14.4 Z M33.3846154,33.6093744 C36.3379615,33.6093744 39.2910072,34.7444976 41.5444735,37.0125024 L57.1003594,52.6687488 L62,57.6 L67.5144231,63.15 C69.5270385,65.1756 72.7767494,65.1568512 74.7893648,63.1312512 C76.8067494,61.1056512 76.8067494,57.8116512 74.7893648,55.7812512 L69.2935703,50.2593744 L72.9170649,46.6125024 C77.4239928,42.0764976 84.7298534,42.0764976 89.2367812,46.6125024 L109.692308,67.2 L109.692308,81.6 L14.3076923,81.6 L14.3076923,48 L25.2247596,37.0125024 C27.4782212,34.7444976 30.4312692,33.6093744 33.3846154,33.6093744 Z"></path>
        </svg>

        <div class="ds-dialog-title" style="margin-top: 15px">Uploading pictures...</div>

      </div>

    </div>

    <div class="page" *ngIf="page === 4">
      <div class="upload-info">
        <div class="upload-title">Upload complete</div>
        <div class="info"><span style="font-weight: bold">New pictures: </span><span>{{ allProfiles.length }} students</span></div>
        <div class="info"><span style="font-weight: bold">Uploaded pictures: </span><span>{{ allProfiles.length }} students</span></div>
        <div class="info"><span style="font-weight: bold">Errors: </span><span>{{ errors.length }} errors <span *ngIf="errors.length" (click)="generateErrorsCsv()" style="color: #E32C66; cursor: pointer;">[Download]</span></span></div>
      </div>

      <div class="uploaded-users">
        <div class="search-input">
          <app-round-input
            [isSearch]="true"
            [placeholder]="'Search accounts'"
            [focused]="true"
            [width]="'242px'"
            [minWidth]="'242px'"
            (ontextupdate)="searchUsers($event)"
          ></app-round-input>
        </div>

        <div class="user-list" *ngIf="uploadedProfiles.length; else empty">
          <div class="user" *ngFor="let user of uploadedProfiles">
            <div class="user-container">
              <div><img class="picture" [src]="user.profile_picture | resolveAsset" alt="Avatar"></div>
              <div class="profile-info">
                <div class="name">{{ user.display_name }}</div>
                <div class="info" *ngIf="user.student_number"><span style="font-weight: bold">Student Number: </span><span>{{ user.student_number }}</span></div>
                <div class="info"><span style="font-weight: bold">Image Filename: </span><span>{{ user.file_name }}</span></div>
              </div>
            </div>
            <mat-divider *ngIf="uploadedProfiles.length > 1"></mat-divider>
          </div>
        </div>
        <ng-template #empty>
          <div>
            No students found
          </div>
        </ng-template>
      </div>
    </div>


    <div class="update-page" *ngIf="page === 5">
      <div class="block">
        <div class="update-button" style="margin-bottom: 20px">
          <div class="ds-dialog-title">Add/Update Pictures</div>
          <app-gradient-button
            [style.margin-top]="'11px'"
            [rightIcon]="'./assets/Chevron Right (White).svg'"
            [gradient]="'#07ABC3, #07ABC3'"
            (buttonClick)="page = 2"
          >New Upload</app-gradient-button>
        </div>
        <div class="upload-info">
          <div style="display: flex; align-items: center">
            <img [src]="'./assets/Warning (Orange).svg'" alt="">
            <div class="info-title">Missing Pictures</div>
          </div>
          <div class="info">16 students donâ€™t have profile pictures.</div>
          <img class="info-icon" [src]="'./assets/Circle Download (Blue-Gray).svg'" alt="">
        </div>
      </div>
      <mat-divider></mat-divider>
      <div class="block">
        <div class="ds-dialog-title" style="margin-bottom: 18px">Upload History</div>
        <div class="upload-info">
          <div class="upload-title">Dec. 16, 2020 at 2:34 PM</div>
          <div class="info"><span style="font-weight: bold">New pictures: </span><span>1500 students</span></div>
          <div class="info"><span style="font-weight: bold">Uploaded pictures: </span><span>1500 students</span></div>
          <div class="info"><span style="font-weight: bold">Errors: </span><span>5 errors</span></div>
          <img class="info-icon" [src]="'./assets/Circle Download (Blue-Gray).svg'" alt="">
        </div>
      </div>
    </div>

<!--    <div class="page" *ngIf="page === 3">-->
<!--      <div class="ds-dialog-heading">Review Issues ({{ issues.length }})</div>-->
<!--      <div class="view-issuer" *ngFor="let issuer of issues">-->
<!--        <div class="error" *ngIf="issuer.fileNotListed">-->
<!--          <span>{{ 'User ID: ' + issuer.fileNotListed.user_id }}</span><br>-->
<!--          <span>- Image filename not listed</span>-->
<!--        </div>-->
<!--        <div class="error" *ngIf="issuer.noUserIdListed">-->
<!--          <span>{{ 'Image filename: ' + issuer.noUserIdListed.file_name }}</span><br>-->
<!--          <span>- User ID not listed</span>-->
<!--        </div>-->
<!--        <div class="error" *ngIf="issuer.noImgFound">-->
<!--          <span>{{ 'User ID: ' + issuer.noImgFound.user_id + ', Image filename: ' + issuer.noImgFound.file_name }}</span><br>-->
<!--          <span>- No image found</span>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="page">-->
<!--      <div class="imports-success" *ngIf="page === 4">-->
<!--        <div class="success-content">-->
<!--          <img class="slide-center" [src]="'./assets/emptyStates/Upload Success.svg'" alt="upload-file">-->
<!--          <div class="count-accounts">{{ filesToDB.length }} Profile Pictures Added</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

    <div class="footer" *ngIf="page !== 4">
      <mat-divider></mat-divider>
      <div class="footer-content">
        <div class="link" style="color: #7f879d">Need some help?</div>
        <div class="link"><a style="color: #7f879d" href="https://www.smartpass.app/profile-pictures" target="_blank">Watch tutorial</a></div>
        <div class="link"><a style="color: #7f879d" href="https://www.smartpass.app/meeting" target="_blank">Schedule a call</a></div>
      </div>
    </div>
  </div>
</div>
