<div class="wrapper" *ngIf="currentView$ | async as currentView">
  <div class="header">
    <div class="switch-button"
       [style.background-color]="views[currentView].color"
       appCrossPointerEventTarget
       (pointerClickEvent)="openSwitchPage($event)"
    >
      <div class="button-content">
        <img width="35" [src]="'./assets/' + views[currentView].icon + ' (White).svg' | resolveAsset" alt="View Icon">
        <div class="title">{{ views[currentView].title }}</div>
        <img width="9" height="7" [src]="'./assets/Rect (White).svg' | resolveAsset" alt="Rect">
      </div>
    </div>
    <div class="filters">
      <div class="filter">
        <app-filter-button *ngIf="views[currentView].id === 1; else trace"
          (buttonClick)="openFilter($event, 'students')"
          [title]="(!passSearchData.selectedStudents || passSearchData.selectedStudents.length > 1 ? 'Students' + (passSearchData.selectedStudents && passSearchData.selectedStudents.length ? ' (' + passSearchData.selectedStudents.length + ')' : '') : passSearchData.selectedStudents[0].display_name)"
          [filter]="passSearchData.selectedStudents && !!passSearchData.selectedStudents.length"
          (clearData)="passSearchData.selectedStudents = null; autoSearch()">
        </app-filter-button>
        <ng-template #trace>
          <app-filter-button
            (buttonClick)="openFilter($event, 'students')"
            [title]="contactTraceData.selectedStudents ? contactTraceData.selectedStudents[0].display_name : 'Student'"
            [filter]="contactTraceData.selectedStudents && !!contactTraceData.selectedStudents.length"
            [forceButtonClick$]="buttonForceTrigger$"
            (forceButtonClickEvent)="$event.action === 'students' ? openFilter($event.event, $event.action) : null"
            [showClearIcon]="false">
          </app-filter-button>
        </ng-template>
      </div>
      <div class="filter" *ngIf="views[currentView].id === 1">
        <app-filter-button
          (buttonClick)="openFilter($event, 'origin')"
          [title]="'Origin' + (passSearchData.selectedOriginRooms && passSearchData.selectedOriginRooms.length ? ' (' + passSearchData.selectedOriginRooms.length + ')' : '')"
          [filter]="passSearchData.selectedOriginRooms && !!passSearchData.selectedOriginRooms.length"
          (clearData)="passSearchData.selectedOriginRooms = null; autoSearch()"
        ></app-filter-button>
      </div>
      <div class="filter" *ngIf="views[currentView].id === 1">
        <app-filter-button
          (buttonClick)="openFilter($event, 'destination')"
          [title]="'Destination' + (passSearchData.selectedDestinationRooms && passSearchData.selectedDestinationRooms.length ? ' (' + passSearchData.selectedDestinationRooms.length + ')' : '')"
          [filter]="passSearchData.selectedDestinationRooms && !!passSearchData.selectedDestinationRooms.length"
          (clearData)="passSearchData.selectedDestinationRooms = null; autoSearch()"
        ></app-filter-button>
      </div>
      <div class="filter">
        <app-filter-button *ngIf="views[currentView].id === 1; else traceDate"
          [title]="passSearchData.selectedDate ? dateText(passSearchData.selectedDate) : 'Pass start time'"
          (buttonClick)="openFilter($event, 'calendar')"
          [filter]="!!passSearchData.selectedDate"
          (clearData)="passSearchData.selectedDate = null; adminCalendarOptions = null; autoSearch()"
        >
        </app-filter-button>
        <ng-template #traceDate>
          <app-filter-button
            [title]="contactTraceData.selectedDate ? dateText(contactTraceData.selectedDate) : 'Time range'"
            (buttonClick)="openFilter($event, 'calendar')"
            [filter]="!!contactTraceData.selectedDate"
            (clearData)="contactTraceData.selectedDate = null; adminCalendarOptions = null;"
            [showClearIcon]="false"
            [forceButtonClick$]="buttonForceTrigger$"
            (forceButtonClickEvent)="$event.action === 'calendar' ? openFilter($event.event, $event.action) : null"
          >
          </app-filter-button>
        </ng-template>
      </div>
    </div>

    <div class="search-button" *ngIf="views[currentView].id === 1 && (passSearchState.countPasses$ | async)">
      <div class="count" *ngIf="!selectedRows.length; else selected">{{ numberWithCommas(passSearchState.countPasses$ | async) }} pass{{ (passSearchState.countPasses$ | async) > 1 ? 'es' : '' }}</div>
      <ng-template #selected>
        <div class="count" style="color: #1F195E; background-color: #ECF1FF">{{ ((passSearchState.isAllSelected$ | async) ? numberWithCommas(passSearchState.countPasses$ | async) : numberWithCommas(selectedRows.length)) }}/{{ numberWithCommas(passSearchState.countPasses$ | async) }} selected</div>
      </ng-template>
    </div>

    <div class="search-button" *ngIf="views[currentView].id === 3">
      <div class="buttons">
        <app-gradient-button
          *ngIf="!contactTraceState.isEmpty && !(contactTraceState.length$ | async)"
          [disabled]="!contactTraceData.selectedStudents || !contactTraceData.selectedDate"
          [gradient]="views[currentView].color + ', ' + views[currentView].color"
          [rightIcon]="'./assets/Chevron Right (White).svg'"
          [size]="'medium'"
          (buttonClick)="contactTrace()"
          (disabledButtonClick)="openInvalidFields()"
        >{{ views[currentView].title }}
        </app-gradient-button>
        <app-gradient-button
          *ngIf="(contactTraceState.length$ | async) || this.contactTraceState.isEmpty"
          [gradient]="'#F4F4F4, #F4F4F4'"
          [rightIcon]="'./assets/Close.svg'"
          [minWidth]="'100px'"
          [minHeight]="'40px'"
          [padding]="'0px 16px'"
          [fontSize]="'14px'"
          [size]="'editable'"
          [leftImageWidth]="'13px'"
          [leftImageHeight]="'13px'"
          [textColor]="'#7f879d'"
          (buttonClick)="clearContactTraceData()">
          Clear
        </app-gradient-button>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="pass-search" *ngIf="views[currentView].id === 1">
      <app-sp-data-table
        [isCheckbox]="isCheckbox$"
        [data$]="searchedPassData$"
        [loading$]="passSearchState.loading$"
        [showEmptyState]="passSearchState.isEmpty && passSearchState.loaded$ | async"
        [emptyIcon]="'./assets/Pass Search (Blue-Gray).svg'"
        [emptyText]="'No passes found with the selected filters.'"
        [currentPage]="currentView$.value"
        (loadMoreData)="loadMorePasses()"
        (sortClickEvent)="sortHeaders($event)"
        [height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'"
        [isRowClick]="true"
        (rowClickEvent)="passClick($event.id)"
        [sort]="passSearchState.sortPasses$ | async"
        [sortColumn]="sortColumn"
        [sortLoading$]="passSearchState.sortPassesLoading$"
        [countAllData]="passSearchState.countPasses$ | async"
        (exportPasses)="exportPasses()"
      ></app-sp-data-table>
    </div>
    <div class="contact-trace" *ngIf="views[currentView].id === 3" [style.height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'">
      <app-sp-data-table
        *ngIf="showContactTraceTable; else empty"
        [isCheckbox]="isCheckbox$"
        [data$]="contactTraceData$"
        [loading$]="contactTraceState.loading$"
        [showEmptyState]="contactTraceState.isEmpty && contactTraceState.loaded$ | async"
        [currentPage]="currentView$.value"
        [emptyIcon]="'./assets/Contact Trace (Blue-Gray).svg'"
        [emptyText]="contactTraceData.selectedStudents[0].display_name + ' did not have an overlapping pass with another student'"
        [height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'"
        [isLoadMore]="false"
      ></app-sp-data-table>
      <ng-template #empty>
        <div class="contact-empty">
          <img width="135" style="opacity: 0.2" [src]="'./assets/Contact Trace (Blue-Gray).svg' | resolveAsset" alt="Empty">
          <div class="description">
            Stay ahead of the spread to instantly trace back possibly infected students in your school.
          </div>
        </div>
      </ng-template>
    </div>

  </div>
</div>
