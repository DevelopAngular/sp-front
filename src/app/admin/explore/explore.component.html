<div class="wrapper" *ngIf="currentView$ | async as currentView">
  <div class="header">
    <div class="switch-button"
       [style.background-color]="views[currentView].color"
       appCrossPointerEventTarget
       (pointerClickEvent)="openSwitchPage($event)"
    >
      <div class="button-content">
        <img width="35" [src]="'./assets/' + views[currentView].icon + ' (White).svg' | resolveAsset" alt="View Icon">
        <div class="title">{{ views[currentView].title }}</div>
        <img width="9" height="7" [src]="'./assets/Rect (White).svg' | resolveAsset" alt="Rect">
      </div>
    </div>
    <div class="filters" [ngSwitch]="views[currentView].id">
      <div class="filter">
        <app-filter-button *ngSwitchCase="1"
          (buttonClick)="openFilter($event, 'students')"
          [title]="(!passSearchData.selectedStudents || passSearchData.selectedStudents.length > 1 ? 'Students' + (passSearchData.selectedStudents && passSearchData.selectedStudents.length ? ' (' + passSearchData.selectedStudents.length + ')' : '') : passSearchData.selectedStudents[0].display_name)"
          [filter]="passSearchData.selectedStudents && !!passSearchData.selectedStudents.length"
          (clearData)="passSearchData.selectedStudents = null; checkQueryParams(); autoSearch()"
          [openedFilter]="!!dialog.getDialogById('students_filter')">
        </app-filter-button>
        <app-filter-button *ngSwitchCase="2"
         (buttonClick)="openFilter($event, 'students')"
         [title]="(!reportSearchData.selectedStudents || reportSearchData.selectedStudents.length > 1 ? 'Students' + (reportSearchData.selectedStudents && reportSearchData.selectedStudents.length ? ' (' + reportSearchData.selectedStudents.length + ')' : '') : reportSearchData.selectedStudents[0].display_name)"
         [filter]="reportSearchData.selectedStudents && !!reportSearchData.selectedStudents.length"
         (clearData)="reportSearchData.selectedStudents = null; autoSearch()"
         [openedFilter]="!!dialog.getDialogById('students_filter')">
        </app-filter-button>
        <app-filter-button *ngSwitchCase="3"
          (buttonClick)="openFilter($event, 'students')"
          [title]="contactTraceData.selectedStudents ? contactTraceData.selectedStudents[0].display_name : 'Student'"
          [filter]="contactTraceData.selectedStudents && !!contactTraceData.selectedStudents.length"
          [forceButtonClick$]="buttonForceTrigger$"
          (forceButtonClickEvent)="$event.action === 'students' ? openFilter($event.event, $event.action) : null"
          [showClearIcon]="false"
          [openedFilter]="!!dialog.getDialogById('students_filter')">
        </app-filter-button>
      </div>
      <div class="filter" *ngSwitchCase="2">
        <app-filter-button
         (buttonClick)="openFilter($event, 'teachers')"
         [title]="(!reportSearchData.selectedTeachers || reportSearchData.selectedTeachers.length > 1 ? 'Submitted by' + (reportSearchData.selectedTeachers && reportSearchData.selectedTeachers.length ? ' (' + reportSearchData.selectedTeachers.length + ')' : '') : reportSearchData.selectedTeachers[0].display_name)"
         [filter]="reportSearchData.selectedTeachers && !!reportSearchData.selectedTeachers.length"
         (clearData)="reportSearchData.selectedTeachers = null; autoSearch()"
         [openedFilter]="!!dialog.getDialogById('teachers_filter')">
        </app-filter-button>
      </div>
      <div class="filter" *ngSwitchCase="1">
        <app-filter-button
          (buttonClick)="openFilter($event, 'origin')"
          [title]="'Origin' + (passSearchData.selectedOriginRooms && passSearchData.selectedOriginRooms.length ? ' (' + passSearchData.selectedOriginRooms.length + ')' : '')"
          [filter]="passSearchData.selectedOriginRooms && !!passSearchData.selectedOriginRooms.length"
          (clearData)="passSearchData.selectedOriginRooms = null; checkQueryParams(); autoSearch()"
          [openedFilter]="!!dialog.getDialogById('origin_filter')"
        ></app-filter-button>
      </div>
      <div class="filter" *ngSwitchCase="1">
        <app-filter-button
          (buttonClick)="openFilter($event, 'destination')"
          [title]="'Destination' + (passSearchData.selectedDestinationRooms && passSearchData.selectedDestinationRooms.length ? ' (' + passSearchData.selectedDestinationRooms.length + ')' : '')"
          [filter]="passSearchData.selectedDestinationRooms && !!passSearchData.selectedDestinationRooms.length"
          (clearData)="passSearchData.selectedDestinationRooms = null; checkQueryParams(); autoSearch()"
          [openedFilter]="!!dialog.getDialogById('destination_filter')"
        ></app-filter-button>
      </div>
      <div class="filter">
        <app-filter-button *ngSwitchCase="1"
          [title]="passSearchData.selectedDate ? dateText(passSearchData.selectedDate) : 'Pass start time'"
          (buttonClick)="openFilter($event, 'calendar')"
          [filter]="!!passSearchData.selectedDate"
          (clearData)="passSearchData.selectedDate = null; checkQueryParams(); adminCalendarOptions = null; autoSearch()"
          [openedFilter]="!!dialog.getDialogById('calendar_filter')">
        </app-filter-button>
        <app-filter-button *ngSwitchCase="2"
         [title]="reportSearchData.selectedDate ? dateText(reportSearchData.selectedDate) : 'Date submitted'"
         (buttonClick)="openFilter($event, 'calendar')"
         [filter]="!!reportSearchData.selectedDate"
         (clearData)="reportSearchData.selectedDate = null; adminCalendarOptions = null; autoSearch()"
         [showClearIcon]="true"
         [openedFilter]="!!dialog.getDialogById('calendar_filter')">
        </app-filter-button>
        <app-filter-button *ngSwitchCase="3"
          [title]="contactTraceData.selectedDate ? dateText(contactTraceData.selectedDate) : 'Time range'"
          (buttonClick)="openFilter($event, 'calendar')"
          [filter]="!!contactTraceData.selectedDate"
          (clearData)="contactTraceData.selectedDate = null; adminCalendarOptions = null;"
          [showClearIcon]="false"
          [forceButtonClick$]="buttonForceTrigger$"
          (forceButtonClickEvent)="$event.action === 'calendar' ? openFilter($event.event, $event.action) : null"
          [openedFilter]="!!dialog.getDialogById('calendar_filter')">
        </app-filter-button>
      </div>
    </div>

    <div class="search-button" *ngIf="views[currentView].id === 1 && passSearchState.countPasses$ | async as countPasses">
      <app-filter-button
        *ngIf="!selectedRows.length; else selected" [openedFilter]="true"
        [title]="(numberWithCommas(countPasses) + ' pass' + (countPasses > 1 ? 'es' : ''))"
        [isDownloadButton]="true"
        [customToolTip]="'Click to export passes'"
        (buttonClick)="downloadPasses(countPasses)">
      </app-filter-button>
      <ng-template #selected>
        <app-filter-button
          [filter]="true"
          [title]="((passSearchState.isAllSelected$ | async) ? numberWithCommas(countPasses) : numberWithCommas(selectedRows.length)) + '/' + numberWithCommas(countPasses) + ' selected'"
          [isDownloadButton]="true"
          [customToolTip]="'Click to export passes'"
          (buttonClick)="downloadPasses(countPasses)">
        </app-filter-button>
      </ng-template>
    </div>

    <div class="search-button" *ngIf="views[currentView].id === 3">
      <div class="buttons">
        <app-gradient-button
          *ngIf="!contactTraceState.isEmpty && !(contactTraceState.length$ | async)"
          [disabled]="!contactTraceData.selectedStudents || !contactTraceData.selectedDate"
          [gradient]="views[currentView].color + ', ' + views[currentView].color"
          [rightIcon]="'./assets/Chevron Right (White).svg'"
          [size]="'medium'"
          (buttonClick)="contactTrace()"
          (disabledButtonClick)="openInvalidFields()"
        >{{ views[currentView].title }}
        </app-gradient-button>
        <app-gradient-button
          *ngIf="(contactTraceState.length$ | async) || this.contactTraceState.isEmpty"
          [gradient]="'#F4F4F4, #F4F4F4'"
          [rightIcon]="'./assets/Close.svg'"
          [minWidth]="'100px'"
          [minHeight]="'40px'"
          [padding]="'0px 16px'"
          [fontSize]="'14px'"
          [size]="'editable'"
          [leftImageWidth]="'13px'"
          [leftImageHeight]="'13px'"
          [textColor]="'#7f879d'"
          (buttonClick)="clearContactTraceData()">
          Clear
        </app-gradient-button>
        <app-gradient-button
          [style.margin-left]="'13px'"
          *ngIf="(contactTraceState.length$ | async)"
          [gradient]="'#F4F4F4, #F4F4F4'"
          [rightIcon]="'./assets/Circle Download (Blue-Gray).svg'"
          [textColor]="'#7f879d'"
          (buttonClick)="generateCSV()"
        >Download</app-gradient-button>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="pass-search" *ngIf="views[currentView].id === 1">
      <app-sp-data-table
        [isCheckbox]="isCheckbox$"
        [data$]="searchedPassData$"
        [loading$]="passSearchState.loading$"
        [showEmptyState]="passSearchState.isEmpty && passSearchState.loaded$ | async"
        [emptyIcon]="'./assets/Pass Search (Blue-Gray).svg'"
        [emptyText]="'No passes found with the selected filters.'"
        [currentPage]="currentView$.value"
        (loadMoreData)="loadMorePasses()"
        (sortClickEvent)="sortHeaders($event)"
        [height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'"
        [isRowClick]="true"
        (rowClickEvent)="passClick($event.id)"
        [sort]="passSearchState.sortPasses$ | async"
        [sortColumn]="sortColumn"
        [sortLoading$]="passSearchState.sortPassesLoading$"
        [showPrintButtons]="false"
        (exportPasses)="exportPasses()"
        [disabledInfinityScroll]="!(passSearchState.nextUrl$ | async)"
      ></app-sp-data-table>
    </div>
    <div class="contact-trace" *ngIf="views[currentView].id === 3" [style.height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'">
      <app-sp-data-table
        *ngIf="showContactTraceTable; else empty"
        [isCheckbox]="isCheckbox$"
        [data$]="contactTraceData$"
        [loading$]="contactTraceState.loading$"
        [showEmptyState]="contactTraceState.isEmpty && contactTraceState.loaded$ | async"
        [currentPage]="currentView$.value"
        [emptyIcon]="'./assets/Contact Trace (Blue-Gray).svg'"
        [emptyText]="contactTraceData.selectedStudents[0].display_name + ' did not have an overlapping pass with another student'"
        [height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'"
        [disabledInfinityScroll]="true"
        [showPrintButtons]="false"
      ></app-sp-data-table>
      <ng-template #empty>
        <div class="contact-empty">
          <img width="135" style="opacity: 0.2" [src]="'./assets/Contact Trace (Blue-Gray).svg' | resolveAsset" alt="Empty">
          <div class="description">
            Stay ahead of the spread to instantly trace back possibly infected students in your school.
          </div>
        </div>
      </ng-template>
    </div>

    <div class="report-search" *ngIf="views[currentView].id === 2">
      <app-sp-data-table
        [isCheckbox]="isCheckbox$"
        [data$]="reportsSearchData$"
        [loading$]="reportSearchState.loading$"
        [currentPage]="currentView$.value"
        [showEmptyState]="reportSearchState.isEmpty && reportSearchState.loaded$ | async"
        [emptyIcon]="'./assets/Report Search (Blue-Gray).svg'"
        [emptyText]="'No reports found with the selected filters.'"
        [height]="(schools$ | async).length > 1 ? 'calc(100vh - 200px)' : 'calc(100vh - 150px)'"
        [itemSize]="66"
        [isRowClick]="true"
        [showPrintButtons]="false"
        (loadMoreData)="loadMoreReports()"
        (rowClickEvent)="openReportDialog($event)"
        [sort]="'desc'"
        [sortColumn]="'Date submitted'"
        [disabledInfinityScroll]="!(reportSearchState.nextUrl$ | async)"
      ></app-sp-data-table>
    </div>

  </div>
</div>
