<form [formGroup]="form">
  <div class="overlay-container">
    <div class="overlay-header" [ngStyle]="{'background-image': gradientColor}">
      <div class="isEdit" *ngIf="isValidForm && overlayType === 'newRoom' || overlayType === 'editRoom'">
        <input type="checkbox" name="isEdit" formControlName="isEdit" class="isEdit-checkbox" id="isEdit" checked>
        <label class="isEdit-label" for="isEdit"></label>
      </div>
      <img class="back-button"
           *ngIf="overlayType !== 'addExisting'
           && overlayType !== 'newRoomInFolder'
           && overlayType !== 'importRooms'
           && !isValidForm
           && overlayType !== 'settingsRooms'
           && overlayType !== 'edit'
           && overlayType !== 'editRoom'"
           [src]="'./assets/Back Button (White).png' | resolveAsset" (click)="back()">
      <div class="title" *ngIf="overlayType === 'newRoom' || overlayType === 'editRoom'">{{ roomName }}</div>
      <div
        class="title"
        *ngIf="overlayType === 'newFolder'
        || overlayType === 'newRoomInFolder'
        || overlayType === 'addExisting'
        || overlayType === 'importRooms'
        || overlayType === 'settingsRooms'
        || overlayType === 'edit'"
      >{{ folderName }}
      </div>
      <div *ngIf="(overlayType === 'newRoom' && color_profile && selectedIcon) || overlayType === 'edit' || overlayType === 'editRoom' || (overlayType === 'newFolder' && color_profile && selectedIcon)" style="margin-right: 25px;width: 121px;">
        <app-gradient-button *ngIf="!requireValidator(timeLimit) && overlayType === 'edit'"
                             [minHeight]="'40px'"
                             [style.width]="'120px'"
                             [cursor]="'pointer'"
                             [fontSize]="'12px'"
                             (buttonClick)="done()"
        >
          Publish</app-gradient-button>
        <div *ngIf="isValidForm || (overlayType === 'editRoom' || (overlayType === 'newFolder' && selectedRooms.length > 0))" class="button" (click)="onCancel()">Pubish</div>
        <div *ngIf="!isValidForm && overlayType !== 'edit' && overlayType !== 'editRoom' && overlayType !== 'newFolder'" style="color: white">Incomplete</div>
      </div>
    </div>

<div style="position: relative">
<div class="inactive" *ngIf="!form.get('isEdit').value"></div>
  <div class="overlay-content">
    <div class="left-content">
      <div class="edit-rooms-left-content" *ngIf="overlayType === 'edit'">
        <div class="edit-rooms-left-title">Bulk edit the rooms added. Any change will override the previous setting.</div>
      </div>
      <div class="new-room-in-folder"
           *ngIf="overlayType === 'newRoomInFolder' || overlayType === 'importRooms' || overlayType === 'settingsRooms'">
          <div class="new-room-in-folder-header">
            <img class="back-button" (click)="(overlayType === 'settingsRooms' ? (isEditRooms ? setLocation('newFolder') : setLocation('importRooms')) : setLocation('newFolder'))" [src]="'./assets/Back Button (Grey).png' | resolveAsset">
            <div [ngClass]="{'room-in-folder-title-inactive': !isValidForm, 'room-in-folder-title-active': isValidForm || (overlayType === 'settingsRooms')}">
              {{ (overlayType === 'newRoomInFolder' ? roomName : (overlayType === 'settingsRooms' ? (isEditRooms ? 'Editing ' + readyRoomsToEdit.length : 'Adding ' + selectedRooms.length)  + ' Rooms' : 'Import Rooms')) }}
            </div>
            <div class="header-in-folder-button">
              <span *ngIf="overlayType === 'settingsRooms' && requireValidator(timeLimit)">Incomplete</span>
                <app-gradient-button *ngIf="isValidForm || (!requireValidator(timeLimit) && overlayType === 'settingsRooms')"
                        [minHeight]="'40px'"
                        [style.width]="'120px'"
                        [cursor]="'pointer'"
                        [fontSize]="'12px'"
                        (buttonClick)="done()"
                >
                Done</app-gradient-button>
            </div>
          </div>
        <div class="edit-rooms-info" *ngIf="overlayType === 'settingsRooms'">
          Bulk edit the rooms added. {{ (isEditRooms ? 'Any change will override thi previous setting' : 'Each room can be individually customized later.') }}
        </div>
      </div>
      <div class="room-inputs" *ngIf="overlayType === 'newRoom' || overlayType === 'newFolder' || overlayType === 'newRoomInFolder' || overlayType === 'editRoom'">
        <div class="room-name">
          <app-input
             *ngIf="overlayType === 'newRoom' || overlayType === 'newRoomInFolder' || overlayType === 'editRoom'"
             [input_label]="'Room Name'"
             [input_value]="(roomName !== 'New Room' ? roomName : '')"
             [Success]="!requireValidator(roomName)"
             (onUpdate)="roomName = $event === '' ? 'New Room': $event;">
          </app-input>
          <app-input
              *ngIf="overlayType === 'newFolder'"
              [input_label]="'Folder Name'"
              [input_value]="(folderName !== 'New Folder' ? folderName : '')"
              [Success]="!requireValidator(folderName)"
              (onUpdate)="folderName = $event === '' ? 'New Folder': $event; requireValidator(folderName) ? readyRoomsToEdit=[] : readyRoomsToEdit">
          </app-input>
        </div>
        <div class="room-number" *ngIf="overlayType === 'newRoom' || overlayType === 'newRoomInFolder' || overlayType === 'editRoom'">
          <app-input [input_label]="'Room Number'" [input_value]="roomNumber" [Success]="!requireValidator(roomNumber)" [placeholder]="'Number'" (onUpdate)="roomNumber=$event"></app-input>
        </div>
      </div>
      <div class="teacher-search" *ngIf="overlayType === 'newRoom' || overlayType === 'newRoomInFolder' || overlayType === 'editRoom'">
        <div class="teacher-title">Teachers in Room</div>
        <app-profiles-search [placeholder]="'Search Teacher'" [selectedStudents]="selectedTichers" (isEmitUsers)="isEmitTeachers($event)" (onUpdate)="selectTeacherEvent($event)" [role]="'_profile_teacher'"></app-profiles-search>
      </div>
      <div style="display: flex"
           *ngIf="(overlayType === 'newRoom'
           || overlayType === 'newRoomInFolder'
           || overlayType === 'settingsRooms'
           || overlayType === 'edit'
           || overlayType === 'editRoom') && !showSearchTeacherOptions"
      >
        <div class="travel-picker">
          <div class="toggle-label">Travel Type</div>
          <app-toggle-picker (onSelect)="travelUpdate($event)" [choices]="['Round-trip', 'One-way' , 'Both']" [width]="'350px'" [height]="'30px'" [altColor]="'#1f195e'" [border]="'#1f195e'"></app-toggle-picker>
        </div>
        <div class="time-limit"
             *ngIf="overlayType === 'newRoom'
             || overlayType === 'newRoomInFolder'
             || overlayType === 'settingsRooms'
             || overlayType === 'edit'
             || overlayType === 'editRoom'"
        >
          <app-input [input_label]="'Time Limit'" [input_value]="timeLimit" [Success]="!requireValidator(timeLimit)" [placeholder]="'minutes'" (onUpdate)="timeLimit=$event"></app-input>
        </div>
      </div>
      <div class="restriction-settings"
           *ngIf="(overlayType === 'newRoom'
           || overlayType === 'newRoomInFolder'
           || overlayType === 'settingsRooms'
           || overlayType === 'edit'
           || overlayType === 'editRoom') && !showSearchTeacherOptions"
      >
        <div class="restriction-picker-1">
          <div class="toggle-label">Restriction For Now</div>
          <app-toggle-picker (onSelect)="nowRestriction = $event === 'Restricted'" [currentChoose]="nowRestriction || null" [choices]="['Unrestricted', 'Restricted']" [width]="'100%'" [height]="'30px'" [altColor]="'#1f195e'" [border]="'#1f195e'"></app-toggle-picker>
        </div>
        <div class="restriction-picker-2">
          <div class="toggle-label">Restriction For Future</div>
          <app-toggle-picker (onSelect)="futureRestriction = $event === 'Restricted'" [currentChoose]="futureRestriction || null" [choices]="['Unrestricted', 'Restricted']" [width]="'100%'" [height]="'30px'" [altColor]="'#1f195e'" [border]="'#1f195e'"></app-toggle-picker>
        </div>
      </div>

      <div class="footer-delete-button" *ngIf="(overlayType === 'editRoom' && isValidForm) && !showSearchTeacherOptions">
        <app-gradient-button
                [gradient]="'#F52B4F, #F37426'"
                [minHeight]="'40px'"
                [style.width]="'140px'"
                [cursor]="'pointer'"
                [fontSize]="'12px'"
                (buttonClick)="deleteRoom()"
        >
          Delete Room</app-gradient-button>

        <div class="footer-info-text">
          This will erase all active and scheduled passes to and from this room.<br/>
          This will not erase any expired passes to or from this room.
        </div>
      </div>

      <div class="rooms-in-folder" *ngIf="overlayType === 'newFolder'">
        <div class="rooms-in-folder-title">Rooms in Folder ({{ selectedRooms.length }})</div>
        <div class="rooms-in-folder-content" [ngClass]="{'rooms-scrolling': selectedRooms.length > 5}">
          <div class="not-rooms-in-folder" *ngIf="requireValidator(folderName)">To add rooms, enter a folder name and select an appearance</div>

          <div class="content-buttons-in-folder" *ngIf="!requireValidator(folderName) && readyRoomsToEdit.length <= 0 && selectedRooms.length <= 5">
              <div class="button-in-folder" *ngFor="let button of buttonsInFolder">
                <app-gradient-button
                        [minHeight]="'35px'"
                        [style.width]="'120px'"
                        [cursor]="'pointer'"
                        [fontSize]="'12px'"
                        (buttonClick)="setLocation(button.location)"
                        [leftIcon]="button.icon"
                        [leftImageWidth]="'10px'"
                        [leftImageHeight]="'10px'"
                >
                  {{ button.title }}</app-gradient-button>
              </div>
          </div>
          <div class="content-buttons-in-folder" *ngIf="!requireValidator(folderName) && readyRoomsToEdit.length > 0 && selectedRooms.length <= 5">
            <div class="button-in-folder" *ngFor="let button of buttonsWithSelectedRooms">
              <app-gradient-button
                      [minHeight]="'35px'"
                      [gradient]="button.color"
                      [style.width]="button.width"
                      [cursor]="'pointer'"
                      [fontSize]="'12px'"
                      (buttonClick)="onEditRooms(button.action)"
              >
                {{ button.title }}</app-gradient-button>
            </div>
          </div>

          <div class="rooms-list" *ngIf="selectedRooms.length > 0 && !requireValidator(folderName)">
            <mat-list>
              <div class="room" *ngFor="let room of selectedRooms">
                <mat-checkbox (change)="selectedRoomsEvent($event, room)">
                  <mat-list-item>{{ room.title }}</mat-list-item>
                </mat-checkbox>
                <mat-divider></mat-divider>
              </div>
            </mat-list>
          </div>


          <div class="content-buttons-in-folder button-column" *ngIf="!requireValidator(folderName) && readyRoomsToEdit.length <= 0 && selectedRooms.length > 5">
            <div class="button-in-folder gd-button" *ngFor="let button of buttonsInFolder">
              <app-gradient-button
                      [minHeight]="'35px'"
                      [style.width]="'120px'"
                      [cursor]="'pointer'"
                      [fontSize]="'12px'"
                      (buttonClick)="setLocation(button.location)"
                      [leftIcon]="button.icon"
                      [leftImageWidth]="'10px'"
                      [leftImageHeight]="'10px'"
              >
                {{ button.title }}</app-gradient-button>
            </div>
          </div>
          <div class="content-buttons-in-folder button-column" *ngIf="!requireValidator(folderName) && readyRoomsToEdit.length > 0 && selectedRooms.length > 5">
            <div class="button-in-folder gd-button" *ngFor="let button of buttonsWithSelectedRooms">
              <app-gradient-button
                      [minHeight]="'35px'"
                      [gradient]="button.color"
                      [style.width]="button.width"
                      [cursor]="'pointer'"
                      [fontSize]="'12px'"
                      (buttonClick)="onEditRooms(button.action)"
              >
                {{ button.title }}</app-gradient-button>
            </div>
          </div>


        </div>
      </div>

      <div class="add-existing-content" *ngIf="overlayType === 'addExisting'">
        <div class="existing-room-header">
          <img class="back-button" (click)="setLocation('newFolder')" [src]="'./assets/Back Button (Grey).png' | resolveAsset">
          <div class="header-title">Add Existing Room to Folder</div>
        </div>
        <div class="add-rooms-button" *ngIf="selectedRoomsInFolder.length > 0">
          <div class="selected-rooms-text">{{ selectedRoomsInFolder.length }} Rooms Selected</div>
          <app-gradient-button
                  [minHeight]="'35px'"
                  [style.width]="'120px'"
                  [cursor]="'pointer'"
                  [fontSize]="'12px'"
                  (buttonClick)="addToFolder()"
          >
            Add to Folder</app-gradient-button>
        </div>
        <div class="info-text" *ngIf="!selectedRoomsInFolder || selectedRoomsInFolder.length === 0">
          <span>Choose existing rooms to add to the {{ roomName }} folder.</span><br/>
          <span>Note: appearance settings will be lost</span>
        </div>
        <div class="pinnable-collection">
          <app-pinnable-collection [header]="false" [pinnables]="pinnables$ | async" (roomEvent)="selectedRoomsInFolder=$event"></app-pinnable-collection>
        </div>
      </div>
      <input type="file" formControlName="file" #file style="display: none"/>
      <div class="import-rooms-content" *ngIf="overlayType === 'importRooms'">
        <div class="import-rooms-info">
          Import a list of room names, room numbers, and room names from an Excel spreadsheet or CSV
        </div>
        <div class="download-template-link">Download Template</div>
        <div class="choose-file" (click)="file.click()">
            <img class="choose-icon" [src]="'./assets/Spreadsheet (Grey).png' | resolveAsset">
            <span class="choose-text">Choose File</span>
        </div>
      </div>

    </div>

    <div class="divider"></div>
    <div class="right-content">
      <div style="position: relative" *ngIf="overlayType !== 'edit'">
        <div class="inactive" *ngIf="hideAppearance"></div>
        <div class="right-content-title">Appearance</div>
        <div class="color-picker">
          <app-color-pallet-picker [selectedColorProfile]="color_profile" [colors$]="colors$" (selectedEvent)="changeColor($event)"></app-color-pallet-picker>
        </div>
        <div class="icon-picker">
          <app-icon-picker [icons$]="icons$" (selectedEvent)="selectedIcon=$event"></app-icon-picker>
        </div>
      </div>

        <div class="edit-right-content" *ngIf="overlayType === 'edit'">
          <div class="edit-right-title">Rooms Editing</div>
          <div class="selected-rooms">
            <div class="selected-room" *ngFor="let room of selectedRooms">
              <app-pinnable [pinnable]="room" [width]="'150px'" [height]="'90px'" [iconWidth]="'40px'"></app-pinnable>
            </div>
          </div>
        </div>

    </div>
  </div>
</div> <!-- Inactive div -->
</div> <!-- Overlay container -->
</form>